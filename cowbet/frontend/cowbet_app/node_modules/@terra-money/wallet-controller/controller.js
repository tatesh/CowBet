import { AccAddress, PublicKey, Tx, } from '@terra-money/terra.js';
import { ConnectType, WalletStatus, } from '@terra-money/wallet-types';
import { WebExtensionTxStatus, } from '@terra-money/web-extension-interface';
import deepEqual from 'fast-deep-equal';
import { BehaviorSubject, combineLatest, firstValueFrom, } from 'rxjs';
import { filter, map } from 'rxjs/operators';
import { CHROME_EXTENSION_INSTALL_URL, DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK, } from './env';
import { mapExtensionSignBytesError, mapExtensionTxError, } from './exception/mapExtensionTxError';
import { mapWalletConnectError } from './exception/mapWalletConnectError';
import { selectConnection } from './modules/connect-modal';
import { ExtensionRouter, ExtensionRouterStatus, } from './modules/extension-router';
import { getTerraExtensions, } from './modules/extension-router/multiChannel';
import { connect as reConnect, connectIfSessionExists as reConnectIfSessionExists, readonlyWalletModal, } from './modules/readonly-wallet';
import { connect as wcConnect, connectIfSessionExists as wcConnectIfSessionExists, WalletConnectSessionStatus, } from './modules/walletconnect';
import { getExtensions } from './operators/getExtensions';
import { toConnectedWallet } from './operators/toConnectedWallet';
import { toLcdClient } from './operators/toLcdClient';
import { isDesktopChrome } from './utils/browser-check';
import { checkExtensionReady } from './utils/checkExtensionReady';
import { sortConnections } from './utils/sortConnections';
const CONNECTIONS = {
    [ConnectType.READONLY]: {
        type: ConnectType.READONLY,
        name: 'View an address',
        icon: 'https://assets.terra.money/icon/wallet-provider/readonly.svg',
    },
    [ConnectType.WALLETCONNECT]: {
        type: ConnectType.WALLETCONNECT,
        name: 'Wallet Connect',
        icon: 'https://assets.terra.money/icon/wallet-provider/walletconnect.svg',
    },
};
const DEFAULT_WAITING_CHROME_EXTENSION_INSTALL_CHECK = 1000 * 3;
const WALLETCONNECT_SUPPORT_FEATURES = new Set([
    'post',
]);
const EMPTY_SUPPORT_FEATURES = new Set();
//noinspection ES6MissingAwait
export class WalletController {
    constructor(options) {
        var _a;
        this.options = options;
        this.extension = null;
        this.walletConnect = null;
        this.readonlyWallet = null;
        this.disableReadonlyWallet = null;
        this.disableExtension = null;
        this.disableWalletConnect = null;
        /**
         * Some mobile wallet emulates the behavior of chrome extension.
         * It confirms that the current connection environment is such a wallet.
         * (If you are running connect() by checking availableConnectType, you do not need to use this API.)
         *
         * @see Wallet#isChromeExtensionCompatibleBrowser
         */
        this.isChromeExtensionCompatibleBrowser = () => {
            var _a;
            return ((_a = this.options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK)(navigator.userAgent);
        };
        /**
         * available connect types on the browser
         *
         * @see Wallet#availableConnectTypes
         */
        this.availableConnectTypes = () => {
            return this._availableConnectTypes.asObservable();
        };
        /**
         * available connections includes identifier, name, icon
         *
         * @see Wallet#availableConnections
         */
        this.availableConnections = () => {
            return this._availableConnectTypes.pipe(map((connectTypes) => {
                const connections = [];
                for (const connectType of connectTypes) {
                    if (connectType === ConnectType.EXTENSION) {
                        const terraExtensions = getTerraExtensions();
                        for (const terraExtension of terraExtensions) {
                            connections.push(memoConnection(ConnectType.EXTENSION, terraExtension.name, terraExtension.icon, terraExtension.identifier));
                        }
                    }
                    else {
                        connections.push(CONNECTIONS[connectType]);
                    }
                }
                return sortConnections(connections);
            }));
        };
        /**
         * available install types on the browser
         *
         * in this time, this only contains [ConnectType.EXTENSION]
         *
         * @see Wallet#availableInstallTypes
         */
        this.availableInstallTypes = () => {
            return this._availableInstallTypes.asObservable();
        };
        /**
         * available installations includes identifier, name, icon, url
         *
         * @see Wallet#availableInstallations
         */
        this.availableInstallations = () => {
            return combineLatest([this.availableConnections(), getExtensions()]).pipe(map(([connections, extensions]) => {
                const installedIdentifiers = new Set(connections
                    .filter(({ type, identifier }) => {
                    return type === ConnectType.EXTENSION && !!identifier;
                })
                    .map(({ identifier }) => {
                    return identifier;
                }));
                return extensions
                    .filter(({ identifier }) => {
                    return !installedIdentifiers.has(identifier);
                })
                    .map(({ name, identifier, icon, url }) => {
                    return {
                        type: ConnectType.EXTENSION,
                        identifier,
                        name,
                        icon,
                        url,
                    };
                });
            }));
        };
        /**
         * @see Wallet#status
         * @see Wallet#network
         * @see Wallet#wallets
         */
        this.states = () => {
            return this._states.asObservable();
        };
        /** get connectedWallet */
        this.connectedWallet = () => {
            return this._states.pipe(toConnectedWallet(this));
        };
        /** get lcdClient */
        this.lcdClient = (lcdClientConfig) => {
            return this._states.pipe(toLcdClient(lcdClientConfig));
        };
        /**
         * reload the connected wallet states
         *
         * in this time, this only work on the ConnectType.EXTENSION
         *
         * @see Wallet#recheckStatus
         */
        this.refetchStates = () => {
            var _a;
            if (this.disableExtension) {
                (_a = this.extension) === null || _a === void 0 ? void 0 : _a.refetchStates();
            }
        };
        /**
         * @deprecated Please use availableInstallations
         *
         * install for the connect type
         *
         * @see Wallet#install
         */
        this.install = (type) => {
            if (type === ConnectType.EXTENSION) {
                // TODO separate install links by browser types
                window.open(CHROME_EXTENSION_INSTALL_URL, '_blank');
            }
            else {
                console.warn(`[WalletController] ConnectType "${type}" does not support install() function`);
            }
        };
        /**
         * connect to wallet
         *
         * @see Wallet#connect
         */
        this.connect = async (_type, _identifier) => {
            var _a, _b, _c, _d;
            let type;
            let identifier;
            if (!!_type) {
                type = _type;
                identifier = _identifier;
            }
            else {
                const connections = await firstValueFrom(this.availableConnections());
                const selector = (_a = this.options.selectConnection) !== null && _a !== void 0 ? _a : selectConnection;
                const selected = await selector(connections);
                if (!selected) {
                    return;
                }
                type = selected[0];
                identifier = selected[1];
            }
            switch (type) {
                case ConnectType.READONLY:
                    const networks = Object.keys(this.options.walletConnectChainIds).map((chainId) => this.options.walletConnectChainIds[+chainId]);
                    const createReadonlyWalletSession = (_d = (_c = (_b = this.options).createReadonlyWalletSession) === null || _c === void 0 ? void 0 : _c.call(_b, networks)) !== null && _d !== void 0 ? _d : readonlyWalletModal({ networks });
                    const readonlyWalletSession = await createReadonlyWalletSession;
                    if (readonlyWalletSession) {
                        this.enableReadonlyWallet(reConnect(readonlyWalletSession));
                    }
                    break;
                case ConnectType.WALLETCONNECT:
                    this.enableWalletConnect(wcConnect(this.options));
                    break;
                case ConnectType.EXTENSION:
                    if (!this.extension) {
                        throw new Error(`extension instance is not created!`);
                    }
                    this.extension.connect(identifier);
                    this.enableExtension();
                    break;
                default:
                    throw new Error(`Unknown ConnectType!`);
            }
        };
        /**
         * manual connect to read only session
         *
         * @see Wallet#connectReadonly
         */
        this.connectReadonly = (terraAddress, network) => {
            this.enableReadonlyWallet(reConnect({
                terraAddress,
                network,
            }));
        };
        /** @see Wallet#disconnect */
        this.disconnect = () => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            this.disableReadonlyWallet = null;
            (_b = this.disableExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            this.disableExtension = null;
            (_c = this.disableWalletConnect) === null || _c === void 0 ? void 0 : _c.call(this);
            this.disableWalletConnect = null;
            this.updateStates(this._notConnected);
        };
        /**
         * @see Wallet#post
         * @param tx
         * @param terraAddress only available new extension
         */
        this.post = async (tx, terraAddress) => {
            // ---------------------------------------------
            // extension
            // ---------------------------------------------
            if (this.disableExtension) {
                return new Promise((resolve, reject) => {
                    if (!this.extension) {
                        reject(new Error(`extension instance not created!`));
                        return;
                    }
                    const subscription = this.extension.post(tx, terraAddress).subscribe({
                        next: (txResult) => {
                            if (txResult.status === WebExtensionTxStatus.SUCCEED) {
                                resolve({
                                    ...tx,
                                    result: txResult.payload,
                                    success: true,
                                });
                                subscription.unsubscribe();
                            }
                        },
                        error: (error) => {
                            reject(mapExtensionTxError(tx, error));
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            // ---------------------------------------------
            // wallet connect
            // ---------------------------------------------
            else if (this.walletConnect) {
                return this.walletConnect
                    .post(tx)
                    .then((result) => ({
                    ...tx,
                    result,
                    success: true,
                }))
                    .catch((error) => {
                    throw mapWalletConnectError(tx, error);
                });
            }
            else {
                throw new Error(`There are no connections that can be posting tx!`);
            }
        };
        /**
         * @see Wallet#sign
         * @param tx
         * @param terraAddress only available new extension
         */
        this.sign = async (tx, terraAddress) => {
            if (this.disableExtension) {
                return new Promise((resolve, reject) => {
                    if (!this.extension) {
                        reject(new Error(`extension instance is not created!`));
                        return;
                    }
                    const subscription = this.extension.sign(tx, terraAddress).subscribe({
                        next: (txResult) => {
                            if (txResult.status === WebExtensionTxStatus.SUCCEED) {
                                resolve({
                                    ...tx,
                                    result: Tx.fromData(txResult.payload),
                                    success: true,
                                });
                                subscription.unsubscribe();
                            }
                        },
                        error: (error) => {
                            reject(mapExtensionTxError(tx, error));
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            throw new Error(`sign() method only available on extension`);
        };
        /**
         * @see Wallet#signBytes
         * @param bytes
         * @param terraAddress only available new extension
         */
        this.signBytes = async (bytes, terraAddress) => {
            if (this.disableExtension) {
                return new Promise((resolve, reject) => {
                    if (!this.extension) {
                        reject(new Error(`extension instance is not created!`));
                        return;
                    }
                    const subscription = this.extension
                        .signBytes(bytes, terraAddress)
                        .subscribe({
                        next: (txResult) => {
                            if (txResult.status === WebExtensionTxStatus.SUCCEED) {
                                resolve({
                                    result: {
                                        recid: txResult.payload.recid,
                                        signature: Uint8Array.from(Buffer.from(txResult.payload.signature, 'base64')),
                                        public_key: txResult.payload.public_key
                                            ? PublicKey.fromData(txResult.payload.public_key)
                                            : undefined,
                                    },
                                    success: true,
                                });
                                subscription.unsubscribe();
                            }
                        },
                        error: (error) => {
                            reject(mapExtensionSignBytesError(bytes, error));
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            throw new Error(`signBytes() method only available on extension`);
            // TODO implements signBytes() to other connect types
        };
        /**
         * @see Wallet#hasCW20Tokens
         * @param chainID
         * @param tokenAddrs Token addresses
         */
        this.hasCW20Tokens = async (chainID, ...tokenAddrs) => {
            if (this.availableExtensionFeature('cw20-token')) {
                return this.extension.hasCW20Tokens(chainID, ...tokenAddrs);
            }
            throw new Error(`Does not support hasCW20Tokens() on this connection`);
        };
        /**
         * @see Wallet#addCW20Tokens
         * @param chainID
         * @param tokenAddrs Token addresses
         */
        this.addCW20Tokens = async (chainID, ...tokenAddrs) => {
            if (this.availableExtensionFeature('cw20-token')) {
                return this.extension.addCW20Tokens(chainID, ...tokenAddrs);
            }
            throw new Error(`Does not support addCW20Tokens() on this connection`);
        };
        /**
         * @see Wallet#hasNetwork
         * @param network
         */
        this.hasNetwork = (network) => {
            if (this.availableExtensionFeature('network')) {
                return this.extension.hasNetwork(network);
            }
            throw new Error(`Does not support hasNetwork() on this connection`);
        };
        /**
         * @see Wallet#hasNetwork
         * @param network
         */
        this.addNetwork = (network) => {
            if (this.availableExtensionFeature('network')) {
                return this.extension.addNetwork(network);
            }
            throw new Error(`Does not support addNetwork() on this connection`);
        };
        // ================================================================
        // internal
        // connect type changing
        // ================================================================
        this.availableExtensionFeature = (feature) => {
            if (this.disableExtension && this.extension) {
                const states = this.extension.getLastStates();
                return (states.type === ExtensionRouterStatus.WALLET_CONNECTED &&
                    states.supportFeatures.has(feature));
            }
        };
        this.updateStates = (next) => {
            const prev = this._states.getValue();
            if (next.status === WalletStatus.WALLET_CONNECTED &&
                next.wallets.length === 0) {
                next = {
                    status: WalletStatus.WALLET_NOT_CONNECTED,
                    network: next.network,
                };
            }
            if (prev.status !== next.status || !deepEqual(prev, next)) {
                this._states.next(next);
            }
        };
        this.enableReadonlyWallet = (readonlyWallet) => {
            var _a, _b, _c;
            (_a = this.disableWalletConnect) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            if (this.readonlyWallet === readonlyWallet ||
                (((_c = this.readonlyWallet) === null || _c === void 0 ? void 0 : _c.terraAddress) === readonlyWallet.terraAddress &&
                    this.readonlyWallet.network === readonlyWallet.network)) {
                return;
            }
            if (this.readonlyWallet) {
                this.readonlyWallet.disconnect();
            }
            this.readonlyWallet = readonlyWallet;
            this.updateStates({
                status: WalletStatus.WALLET_CONNECTED,
                network: readonlyWallet.network,
                wallets: [
                    {
                        connectType: ConnectType.READONLY,
                        terraAddress: readonlyWallet.terraAddress,
                        design: 'readonly',
                    },
                ],
                supportFeatures: EMPTY_SUPPORT_FEATURES,
                connection: CONNECTIONS.READONLY,
            });
            this.disableReadonlyWallet = () => {
                readonlyWallet.disconnect();
                this.readonlyWallet = null;
                this.disableReadonlyWallet = null;
            };
        };
        this.enableExtension = () => {
            var _a, _b;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableWalletConnect) === null || _b === void 0 ? void 0 : _b.call(this);
            if (this.disableExtension || !this.extension) {
                return;
            }
            const extensionSubscription = this.extension.states().subscribe({
                next: (extensionStates) => {
                    if (extensionStates.type === ExtensionRouterStatus.WALLET_CONNECTED &&
                        AccAddress.validate(extensionStates.wallet.terraAddress)) {
                        this.updateStates({
                            status: WalletStatus.WALLET_CONNECTED,
                            network: extensionStates.network,
                            wallets: [
                                {
                                    connectType: ConnectType.EXTENSION,
                                    terraAddress: extensionStates.wallet.terraAddress,
                                    design: extensionStates.wallet.design,
                                },
                            ],
                            supportFeatures: extensionStates.supportFeatures,
                            connection: memoConnection(ConnectType.EXTENSION, extensionStates.extensionInfo.name, extensionStates.extensionInfo.icon, extensionStates.extensionInfo.identifier),
                        });
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                },
            });
            this.disableExtension = () => {
                var _a;
                (_a = this.extension) === null || _a === void 0 ? void 0 : _a.disconnect();
                extensionSubscription.unsubscribe();
                this.disableExtension = null;
            };
        };
        this.enableWalletConnect = (walletConnect) => {
            var _a, _b;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            if (this.walletConnect === walletConnect) {
                return;
            }
            if (this.walletConnect) {
                this.walletConnect.disconnect();
            }
            this.walletConnect = walletConnect;
            const subscribeWalletConnect = (wc) => {
                return wc.session().subscribe({
                    next: (status) => {
                        var _a;
                        switch (status.status) {
                            case WalletConnectSessionStatus.CONNECTED:
                                this.updateStates({
                                    status: WalletStatus.WALLET_CONNECTED,
                                    network: (_a = this.options.walletConnectChainIds[status.chainId]) !== null && _a !== void 0 ? _a : this.options.defaultNetwork,
                                    wallets: [
                                        {
                                            connectType: ConnectType.WALLETCONNECT,
                                            terraAddress: status.terraAddress,
                                            design: 'walletconnect',
                                        },
                                    ],
                                    supportFeatures: WALLETCONNECT_SUPPORT_FEATURES,
                                    connection: CONNECTIONS.WALLETCONNECT,
                                });
                                break;
                            default:
                                this.updateStates(this._notConnected);
                                break;
                        }
                    },
                });
            };
            const walletConnectSessionSubscription = subscribeWalletConnect(walletConnect);
            this.disableWalletConnect = () => {
                var _a;
                (_a = this.walletConnect) === null || _a === void 0 ? void 0 : _a.disconnect();
                this.walletConnect = null;
                walletConnectSessionSubscription.unsubscribe();
                this.disableWalletConnect = null;
            };
        };
        this._notConnected = {
            status: WalletStatus.WALLET_NOT_CONNECTED,
            network: options.defaultNetwork,
        };
        this._initializing = {
            status: WalletStatus.INITIALIZING,
            network: options.defaultNetwork,
        };
        this._availableConnectTypes = new BehaviorSubject([
            ConnectType.READONLY,
            ConnectType.WALLETCONNECT,
        ]);
        this._availableInstallTypes = new BehaviorSubject([]);
        this._states = new BehaviorSubject(this._initializing);
        let numSessionCheck = 0;
        // wait checking the availability of the chrome extension
        // 0. check if extension wallet session is exists
        checkExtensionReady((_a = options.waitingChromeExtensionInstallCheck) !== null && _a !== void 0 ? _a : DEFAULT_WAITING_CHROME_EXTENSION_INSTALL_CHECK, this.isChromeExtensionCompatibleBrowser()).then((ready) => {
            var _a;
            if (ready) {
                this._availableConnectTypes.next([
                    ConnectType.EXTENSION,
                    ConnectType.WALLETCONNECT,
                    ConnectType.READONLY,
                ]);
                this.extension = new ExtensionRouter({
                    hostWindow: window,
                    selectExtension: options.selectExtension,
                    dangerously__chromeExtensionCompatibleBrowserCheck: (_a = options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK,
                    defaultNetwork: options.defaultNetwork,
                });
                const subscription = this.extension
                    .states()
                    .pipe(filter(({ type }) => type !== ExtensionRouterStatus.INITIALIZING))
                    .subscribe((extensionStates) => {
                    try {
                        subscription.unsubscribe();
                    }
                    catch (_a) { }
                    if (extensionStates.type === ExtensionRouterStatus.WALLET_CONNECTED &&
                        !this.disableWalletConnect &&
                        !this.disableReadonlyWallet) {
                        this.enableExtension();
                    }
                    else if (numSessionCheck === 0) {
                        numSessionCheck += 1;
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                });
            }
            else {
                if (isDesktopChrome(this.isChromeExtensionCompatibleBrowser())) {
                    this._availableInstallTypes.next([ConnectType.EXTENSION]);
                }
                if (numSessionCheck === 0) {
                    numSessionCheck += 1;
                }
                else {
                    this.updateStates(this._notConnected);
                }
            }
        });
        // 1. check if readonly wallet session is exists
        const draftReadonlyWallet = reConnectIfSessionExists();
        if (draftReadonlyWallet) {
            this.enableReadonlyWallet(draftReadonlyWallet);
            return;
        }
        // 2. check if walletconnect sesison is exists
        const draftWalletConnect = wcConnectIfSessionExists(options);
        if (draftWalletConnect &&
            draftWalletConnect.getLatestSession().status ===
                WalletConnectSessionStatus.CONNECTED) {
            this.enableWalletConnect(draftWalletConnect);
        }
        else if (numSessionCheck === 0) {
            numSessionCheck += 1;
        }
        else {
            this.updateStates(this._notConnected);
        }
    }
}
const memoizedConnections = new Map();
function memoConnection(connectType, name, icon, identifier = '') {
    const key = [connectType, name, icon, identifier].join(';');
    if (memoizedConnections.has(key)) {
        return memoizedConnections.get(key);
    }
    const connection = {
        type: connectType,
        name,
        icon,
        identifier,
    };
    memoizedConnections.set(key, connection);
    return connection;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9AdGVycmEtbW9uZXkvd2FsbGV0LWNvbnRyb2xsZXIvY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsVUFBVSxFQUdWLFNBQVMsRUFDVCxFQUFFLEdBQ0gsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLEVBR0wsV0FBVyxFQVFYLFlBQVksR0FDYixNQUFNLDJCQUEyQixDQUFDO0FBQ25DLE9BQU8sRUFFTCxvQkFBb0IsR0FDckIsTUFBTSxzQ0FBc0MsQ0FBQztBQUM5QyxPQUFPLFNBQVMsTUFBTSxpQkFBaUIsQ0FBQztBQUN4QyxPQUFPLEVBQ0wsZUFBZSxFQUNmLGFBQWEsRUFDYixjQUFjLEdBR2YsTUFBTSxNQUFNLENBQUM7QUFDZCxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFDTCw0QkFBNEIsRUFDNUIsaURBQWlELEdBQ2xELE1BQU0sT0FBTyxDQUFDO0FBQ2YsT0FBTyxFQUNMLDBCQUEwQixFQUMxQixtQkFBbUIsR0FDcEIsTUFBTSxpQ0FBaUMsQ0FBQztBQUN6QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUMxRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUMzRCxPQUFPLEVBQ0wsZUFBZSxFQUNmLHFCQUFxQixHQUN0QixNQUFNLDRCQUE0QixDQUFDO0FBQ3BDLE9BQU8sRUFFTCxrQkFBa0IsR0FDbkIsTUFBTSx5Q0FBeUMsQ0FBQztBQUNqRCxPQUFPLEVBQ0wsT0FBTyxJQUFJLFNBQVMsRUFDcEIsc0JBQXNCLElBQUksd0JBQXdCLEVBRWxELG1CQUFtQixHQUVwQixNQUFNLDJCQUEyQixDQUFDO0FBQ25DLE9BQU8sRUFDTCxPQUFPLElBQUksU0FBUyxFQUNwQixzQkFBc0IsSUFB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Q0FBQyxFQUFFO1FBQ2hDLE9BQU8sbUJBQW1CLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBRSxDQUFDO0tBQ3RDO0lBRUQsTUFBTSxVQUFVLEdBQWU7UUFDN0IsSUFBSSxFQUFFLFdBQVc7UUFDakIsSUFBSTtRQUNKLElBQUk7UUFDSixVQUFVO0tBQ1gsQ0FBQztJQUVGLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFFekMsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFjY0FkZHJlc3MsXG4gIENyZWF0ZVR4T3B0aW9ucyxcbiAgTENEQ2xpZW50LFxuICBQdWJsaWNLZXksXG4gIFR4LFxufSBmcm9tICdAdGVycmEtbW9uZXkvdGVycmEuanMnO1xuaW1wb3J0IHtcbiAgQ29ubmVjdGVkV2FsbGV0LFxuICBDb25uZWN0aW9uLFxuICBDb25uZWN0VHlwZSxcbiAgSW5zdGFsbGF0aW9uLFxuICBOZXR3b3JrSW5mbyxcbiAgU2lnbkJ5dGVzUmVzdWx0LFxuICBTaWduUmVzdWx0LFxuICBUeFJlc3VsdCxcbiAgV2FsbGV0TENEQ2xpZW50Q29uZmlnLFxuICBXYWxsZXRTdGF0ZXMsXG4gIFdhbGxldFN0YXR1cyxcbn0gZnJvbSAnQHRlcnJhLW1vbmV5L3dhbGxldC10eXBlcyc7XG5pbXBvcnQge1xuICBUZXJyYVdlYkV4dGVuc2lvbkZlYXR1cmVzLFxuICBXZWJFeHRlbnNpb25UeFN0YXR1cyxcbn0gZnJvbSAnQHRlcnJhLW1vbmV5L3dlYi1leHRlbnNpb24taW50ZXJmYWNlJztcbmltcG9ydCBkZWVwRXF1YWwgZnJvbSAnZmFzdC1kZWVwLWVxdWFsJztcbmltcG9ydCB7XG4gIEJlaGF2aW9yU3ViamVjdCxcbiAgY29tYmluZUxhdGVzdCxcbiAgZmlyc3RWYWx1ZUZyb20sXG4gIE9ic2VydmFibGUsXG4gIFN1YnNjcmlwdGlvbixcbn0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIENIUk9NRV9FWFRFTlNJT05fSU5TVEFMTF9VUkwsXG4gIERFRkFVTFRfQ0hST01FX0VYVEVOU0lPTl9DT01QQVRJQkxFX0JST1dTRVJfQ0hFQ0ssXG59IGZyb20gJy4vZW52JztcbmltcG9ydCB7XG4gIG1hcEV4dGVuc2lvblNpZ25CeXRlc0Vycm9yLFxuICBtYXBFeHRlbnNpb25UeEVycm9yLFxufSBmcm9tICcuL2V4Y2VwdGlvbi9tYXBFeHRlbnNpb25UeEVycm9yJztcbmltcG9ydCB7IG1hcFdhbGxldENvbm5lY3RFcnJvciB9IGZyb20gJy4vZXhjZXB0aW9uL21hcFdhbGxldENvbm5lY3RFcnJvcic7XG5pbXBvcnQgeyBzZWxlY3RDb25uZWN0aW9uIH0gZnJvbSAnLi9tb2R1bGVzL2Nvbm5lY3QtbW9kYWwnO1xuaW1wb3J0IHtcbiAgRXh0ZW5zaW9uUm91dGVyLFxuICBFeHRlbnNpb25Sb3V0ZXJTdGF0dXMsXG59IGZyb20gJy4vbW9kdWxlcy9leHRlbnNpb24tcm91dGVyJztcbmltcG9ydCB7XG4gIEV4dGVuc2lvbkluZm8sXG4gIGdldFRlcnJhRXh0ZW5zaW9ucyxcbn0gZnJvbSAnLi9tb2R1bGVzL2V4dGVuc2lvbi1yb3V0ZXIvbXVsdGlDaGFubmVsJztcbmltcG9ydCB7XG4gIGNvbm5lY3QgYXMgcmVDb25uZWN0LFxuICBjb25uZWN0SWZTZXNzaW9uRXhpc3RzIGFzIHJlQ29ubmVjdElmU2Vzc2lvbkV4aXN0cyxcbiAgUmVhZG9ubHlXYWxsZXRDb250cm9sbGVyLFxuICByZWFkb25seVdhbGxldE1vZGFsLFxuICBSZWFkb25seVdhbGxldFNlc3Npb24sXG59IGZyb20gJy4vbW9kdWxlcy9yZWFkb25seS13YWxsZXQnO1xuaW1wb3J0IHtcbiAgY29ubmVjdCBhcyB3Y0Nvbm5lY3QsXG4gIGNvbm5lY3RJZlNlc3Npb25FeGlzdHMgYXMgd2NDb25uZWN0SWZTZXNzaW9uRXhpc3RzLFxuICBXYWxsZXRDb25uZWN0Q29udHJvbGxlcixcbiAgV2FsbGV0Q29ubmVjdENvbnRyb2xsZXJPcHRpb25zLFxuICBXYWxsZXRDb25uZWN0U2Vzc2lvblN0YXR1cyxcbn0gZnJvbSAnLi9tb2R1bGVzL3dhbGxldGNvbm5lY3QnO1xuaW1wb3J0IHsgZ2V0RXh0ZW5zaW9ucyB9IGZyb20gJy4vb3BlcmF0b3JzL2dldEV4dGVuc2lvbnMnO1xuaW1wb3J0IHsgdG9Db25uZWN0ZWRXYWxsZXQgfSBmcm9tICcuL29wZXJhdG9ycy90b0Nvbm5lY3RlZFdhbGxldCc7XG5pbXBvcnQgeyB0b0xjZENsaWVudCB9IGZyb20gJy4vb3BlcmF0b3JzL3RvTGNkQ2xpZW50JztcbmltcG9ydCB7IGlzRGVza3RvcENocm9tZSB9IGZyb20gJy4vdXRpbHMvYnJvd3Nlci1jaGVjayc7XG5pbXBvcnQgeyBjaGVja0V4dGVuc2lvblJlYWR5IH0gZnJvbSAnLi91dGlscy9jaGVja0V4dGVuc2lvblJlYWR5JztcbmltcG9ydCB7IHNvcnRDb25uZWN0aW9ucyB9IGZyb20gJy4vdXRpbHMvc29ydENvbm5lY3Rpb25zJztcblxuZXhwb3J0IGludGVyZmFjZSBXYWxsZXRDb250cm9sbGVyT3B0aW9uc1xuICBleHRlbmRzIFdhbGxldENvbm5lY3RDb250cm9sbGVyT3B0aW9ucyB7XG4gIC8qKlxuICAgKiDimqDvuI8gRG9uJ3QgaGFyZGNvZGluZyB0aGlzLCB1c2UgZ2V0Q2hhaW4gT3B0aW9ucygpXG4gICAqXG4gICAqIGZhbGxiYWNrIG5ldHdvcmsgaWYgY29udHJvbGxlciBpcyBub3QgY29ubmVjdGVkXG4gICAqL1xuICBkZWZhdWx0TmV0d29yazogTmV0d29ya0luZm87XG5cbiAgLyoqXG4gICAqIOKaoO+4jyBEb24ndCBoYXJkY29kaW5nIHRoaXMsIHVzZSBnZXRDaGFpbiBPcHRpb25zKClcbiAgICpcbiAgICogZm9yIHdhbGxldGNvbm5lY3RcbiAgICpcbiAgICogVGhlIG5ldHdvcmsgcnVsZXMgcGFzc2VkIGJ5IHRoZSBUZXJyYSBTdGF0aW9uIE1vYmlsZSBhcmUgMCBpcyB0ZXN0bmV0LCAxIGlzIG1haW5uZXQuXG4gICAqXG4gICAqIEFsd2F5cyBzZXQgdGVzdG5ldCBmb3IgMCBhbmQgbWFpbm5ldCBmb3IgMS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgXG4gICAqIGNvbnN0IG1haW5uZXQ6IE5ldHdvcmtJbmZvID0ge1xuICAgKiAgbmFtZTogJ21haW5uZXQnLFxuICAgKiAgY2hhaW5JRDogJ2NvbHVtYnVzLTUnLFxuICAgKiAgbGNkOiAnaHR0cHM6Ly9sY2QudGVycmEuZGV2JyxcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB0ZXN0bmV0OiBOZXR3b3JrSW5mbyA9IHtcbiAgICogIG5hbWU6ICd0ZXN0bmV0JyxcbiAgICogIGNoYWluSUQ6ICdib21iYXktMTInLFxuICAgKiAgbGNkOiAnaHR0cHM6Ly9ib21iYXktbGNkLnRlcnJhLmRldicsXG4gICAqIH1cbiAgICpcbiAgICogY29uc3Qgd2FsbGV0Q29ubmVjdENoYWluSWRzOiBSZWNvcmQ8bnVtYmVyLCBOZXR3b3JrSW5mbz4gPSB7XG4gICAqICAgMDogdGVzdG5ldCxcbiAgICogICAxOiBtYWlubmV0LFxuICAgKiB9XG4gICAqXG4gICAqIDxXYWxsZXRQcm92aWRlciB3YWxsZXRDb25uZWN0Q2hhaW5JZHM9e3dhbGxldENvbm5lY3RDaGFpbklkc30+XG4gICAqIGBgYFxuICAgKi9cbiAgd2FsbGV0Q29ubmVjdENoYWluSWRzOiBSZWNvcmQ8bnVtYmVyLCBOZXR3b3JrSW5mbz47XG5cbiAgLyoqXG4gICAqIHJ1biBhdCBleGVjdXRpbmcgdGhlIGBjb25uZWN0KENvbm5lY3RUeXBlLlJFQURPTkxZKWBcbiAgICovXG4gIGNyZWF0ZVJlYWRvbmx5V2FsbGV0U2Vzc2lvbj86IChcbiAgICBuZXR3b3JrczogTmV0d29ya0luZm9bXSxcbiAgKSA9PiBQcm9taXNlPFJlYWRvbmx5V2FsbGV0U2Vzc2lvbiB8IG51bGw+O1xuXG4gIC8qKlxuICAgKiBydW4gYXQgZXhlY3V0aW5nIHRoZSBgY29ubmVjdCgpYCAtIG9ubHkgdXNlZCB3aGVuIGRvZXMgbm90IGlucHV0IENvbm5lY3RUeXBlXG4gICAqL1xuICBzZWxlY3RDb25uZWN0aW9uPzogKFxuICAgIGNvbm5lY3Rpb25zOiBDb25uZWN0aW9uW10sXG4gICkgPT4gUHJvbWlzZTxbdHlwZTogQ29ubmVjdFR5cGUsIGlkZW50aWZpZXI6IHN0cmluZyB8IHVuZGVmaW5lZF0gfCBudWxsPjtcblxuICAvKipcbiAgICogcnVuIGF0IGV4ZWN1dGluZyB0aGUgYGNvbm5lY3QoQ29ubmVjdFR5cGUuRVhURU5TSU9OKWBcbiAgICogaWYgdXNlciBpbnN0YWxsZWQgbXVsdGlwbGUgd2FsbGV0c1xuICAgKi9cbiAgc2VsZWN0RXh0ZW5zaW9uPzogKFxuICAgIGV4dGVuc2lvbkluZm9zOiBFeHRlbnNpb25JbmZvW10sXG4gICkgPT4gUHJvbWlzZTxFeHRlbnNpb25JbmZvIHwgbnVsbD47XG5cbiAgLyoqXG4gICAqIG1pbGxpc2Vjb25kcyB0byB3YWl0IGNoZWNraW5nIGNocm9tZSBleHRlbnNpb24gaXMgaW5zdGFsbGVkXG4gICAqXG4gICAqIEBkZWZhdWx0IDEwMDAgKiAzIG1pbGlzZWNvbmRzXG4gICAqL1xuICB3YWl0aW5nQ2hyb21lRXh0ZW5zaW9uSW5zdGFsbENoZWNrPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiDimqDvuI8gVGhpcyBBUEkgaXMgYW4gb3B0aW9uIGZvciB3YWxsZXQgZGV2ZWxvcGVycy4gUGxlYXNlIGRvbid0IHVzZSBkQXBwIGRldmVsb3BlcnMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYFxuICAgKiA8V2FsbGV0UHJvdmlkZXIgZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2s9eyh1c2VyQWdlbnQ6IHN0cmluZykgPT4ge1xuICAgKiAgIHJldHVybiAvTXlXYWxsZXRcXC8vLnRlc3QodXNlckFnZW50KTtcbiAgICogfX0+XG4gICAqIGBgYFxuICAgKi9cbiAgZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2s/OiAoXG4gICAgdXNlckFnZW50OiBzdHJpbmcsXG4gICkgPT4gYm9vbGVhbjtcbn1cblxuY29uc3QgQ09OTkVDVElPTlMgPSB7XG4gIFtDb25uZWN0VHlwZS5SRUFET05MWV06IHtcbiAgICB0eXBlOiBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICBuYW1lOiAnVmlldyBhbiBhZGRyZXNzJyxcbiAgICBpY29uOiAnaHR0cHM6Ly9hc3NldHMudGVycmEubW9uZXkvaWNvbi93YWxsZXQtcHJvdmlkZXIvcmVhZG9ubHkuc3ZnJyxcbiAgfSBhcyBDb25uZWN0aW9uLFxuICBbQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVF06IHtcbiAgICB0eXBlOiBDb25uZWN0VHlwZS5XQUxMRVRDT05ORUNULFxuICAgIG5hbWU6ICdXYWxsZXQgQ29ubmVjdCcsXG4gICAgaWNvbjogJ2h0dHBzOi8vYXNzZXRzLnRlcnJhLm1vbmV5L2ljb24vd2FsbGV0LXByb3ZpZGVyL3dhbGxldGNvbm5lY3Quc3ZnJyxcbiAgfSBhcyBDb25uZWN0aW9uLFxufSBhcyBjb25zdDtcblxuY29uc3QgREVGQVVMVF9XQUlUSU5HX0NIUk9NRV9FWFRFTlNJT05fSU5TVEFMTF9DSEVDSyA9IDEwMDAgKiAzO1xuXG5jb25zdCBXQUxMRVRDT05ORUNUX1NVUFBPUlRfRkVBVFVSRVMgPSBuZXcgU2V0PFRlcnJhV2ViRXh0ZW5zaW9uRmVhdHVyZXM+KFtcbiAgJ3Bvc3QnLFxuXSk7XG5cbmNvbnN0IEVNUFRZX1NVUFBPUlRfRkVBVFVSRVMgPSBuZXcgU2V0PFRlcnJhV2ViRXh0ZW5zaW9uRmVhdHVyZXM+KCk7XG5cbi8vbm9pbnNwZWN0aW9uIEVTNk1pc3NpbmdBd2FpdFxuZXhwb3J0IGNsYXNzIFdhbGxldENvbnRyb2xsZXIge1xuICBwcml2YXRlIGV4dGVuc2lvbjogRXh0ZW5zaW9uUm91dGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgd2FsbGV0Q29ubmVjdDogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seVdhbGxldDogUmVhZG9ubHlXYWxsZXRDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBfYXZhaWxhYmxlQ29ubmVjdFR5cGVzOiBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdFR5cGVbXT47XG4gIHByaXZhdGUgX2F2YWlsYWJsZUluc3RhbGxUeXBlczogQmVoYXZpb3JTdWJqZWN0PENvbm5lY3RUeXBlW10+O1xuICBwcml2YXRlIF9zdGF0ZXM6IEJlaGF2aW9yU3ViamVjdDxXYWxsZXRTdGF0ZXM+O1xuXG4gIHByaXZhdGUgZGlzYWJsZVJlYWRvbmx5V2FsbGV0OiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkaXNhYmxlRXh0ZW5zaW9uOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkaXNhYmxlV2FsbGV0Q29ubmVjdDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfbm90Q29ubmVjdGVkOiBXYWxsZXRTdGF0ZXM7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2luaXRpYWxpemluZzogV2FsbGV0U3RhdGVzO1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IG9wdGlvbnM6IFdhbGxldENvbnRyb2xsZXJPcHRpb25zKSB7XG4gICAgdGhpcy5fbm90Q29ubmVjdGVkID0ge1xuICAgICAgc3RhdHVzOiBXYWxsZXRTdGF0dXMuV0FMTEVUX05PVF9DT05ORUNURUQsXG4gICAgICBuZXR3b3JrOiBvcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgIH07XG5cbiAgICB0aGlzLl9pbml0aWFsaXppbmcgPSB7XG4gICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5JTklUSUFMSVpJTkcsXG4gICAgICBuZXR3b3JrOiBvcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgIH07XG5cbiAgICB0aGlzLl9hdmFpbGFibGVDb25uZWN0VHlwZXMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PENvbm5lY3RUeXBlW10+KFtcbiAgICAgIENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgICAgQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVCxcbiAgICBdKTtcblxuICAgIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdFR5cGVbXT4oW10pO1xuXG4gICAgdGhpcy5fc3RhdGVzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxXYWxsZXRTdGF0ZXM+KHRoaXMuX2luaXRpYWxpemluZyk7XG5cbiAgICBsZXQgbnVtU2Vzc2lvbkNoZWNrOiBudW1iZXIgPSAwO1xuXG4gICAgLy8gd2FpdCBjaGVja2luZyB0aGUgYXZhaWxhYmlsaXR5IG9mIHRoZSBjaHJvbWUgZXh0ZW5zaW9uXG4gICAgLy8gMC4gY2hlY2sgaWYgZXh0ZW5zaW9uIHdhbGxldCBzZXNzaW9uIGlzIGV4aXN0c1xuICAgIGNoZWNrRXh0ZW5zaW9uUmVhZHkoXG4gICAgICBvcHRpb25zLndhaXRpbmdDaHJvbWVFeHRlbnNpb25JbnN0YWxsQ2hlY2sgPz9cbiAgICAgICAgREVGQVVMVF9XQUlUSU5HX0NIUk9NRV9FWFRFTlNJT05fSU5TVEFMTF9DSEVDSyxcbiAgICAgIHRoaXMuaXNDaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlcigpLFxuICAgICkudGhlbigocmVhZHk6IGJvb2xlYW4pID0+IHtcbiAgICAgIGlmIChyZWFkeSkge1xuICAgICAgICB0aGlzLl9hdmFpbGFibGVDb25uZWN0VHlwZXMubmV4dChbXG4gICAgICAgICAgQ29ubmVjdFR5cGUuRVhURU5TSU9OLFxuICAgICAgICAgIENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgICAgQ29ubmVjdFR5cGUuUkVBRE9OTFksXG4gICAgICAgIF0pO1xuXG4gICAgICAgIHRoaXMuZXh0ZW5zaW9uID0gbmV3IEV4dGVuc2lvblJvdXRlcih7XG4gICAgICAgICAgaG9zdFdpbmRvdzogd2luZG93LFxuICAgICAgICAgIHNlbGVjdEV4dGVuc2lvbjogb3B0aW9ucy5zZWxlY3RFeHRlbnNpb24sXG4gICAgICAgICAgZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2s6XG4gICAgICAgICAgICBvcHRpb25zLmRhbmdlcm91c2x5X19jaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlckNoZWNrID8/XG4gICAgICAgICAgICBERUZBVUxUX0NIUk9NRV9FWFRFTlNJT05fQ09NUEFUSUJMRV9CUk9XU0VSX0NIRUNLLFxuICAgICAgICAgIGRlZmF1bHROZXR3b3JrOiBvcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLmV4dGVuc2lvblxuICAgICAgICAgIC5zdGF0ZXMoKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgZmlsdGVyKCh7IHR5cGUgfSkgPT4gdHlwZSAhPT0gRXh0ZW5zaW9uUm91dGVyU3RhdHVzLklOSVRJQUxJWklORyksXG4gICAgICAgICAgKVxuICAgICAgICAgIC5zdWJzY3JpYmUoKGV4dGVuc2lvblN0YXRlcykgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9IGNhdGNoIHt9XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgZXh0ZW5zaW9uU3RhdGVzLnR5cGUgPT09IEV4dGVuc2lvblJvdXRlclN0YXR1cy5XQUxMRVRfQ09OTkVDVEVEICYmXG4gICAgICAgICAgICAgICF0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ICYmXG4gICAgICAgICAgICAgICF0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuZW5hYmxlRXh0ZW5zaW9uKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG51bVNlc3Npb25DaGVjayA9PT0gMCkge1xuICAgICAgICAgICAgICBudW1TZXNzaW9uQ2hlY2sgKz0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNEZXNrdG9wQ2hyb21lKHRoaXMuaXNDaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlcigpKSkge1xuICAgICAgICAgIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcy5uZXh0KFtDb25uZWN0VHlwZS5FWFRFTlNJT05dKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChudW1TZXNzaW9uQ2hlY2sgPT09IDApIHtcbiAgICAgICAgICBudW1TZXNzaW9uQ2hlY2sgKz0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh0aGlzLl9ub3RDb25uZWN0ZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyAxLiBjaGVjayBpZiByZWFkb25seSB3YWxsZXQgc2Vzc2lvbiBpcyBleGlzdHNcbiAgICBjb25zdCBkcmFmdFJlYWRvbmx5V2FsbGV0ID0gcmVDb25uZWN0SWZTZXNzaW9uRXhpc3RzKCk7XG5cbiAgICBpZiAoZHJhZnRSZWFkb25seVdhbGxldCkge1xuICAgICAgdGhpcy5lbmFibGVSZWFkb25seVdhbGxldChkcmFmdFJlYWRvbmx5V2FsbGV0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyAyLiBjaGVjayBpZiB3YWxsZXRjb25uZWN0IHNlc2lzb24gaXMgZXhpc3RzXG4gICAgY29uc3QgZHJhZnRXYWxsZXRDb25uZWN0ID0gd2NDb25uZWN0SWZTZXNzaW9uRXhpc3RzKG9wdGlvbnMpO1xuXG4gICAgaWYgKFxuICAgICAgZHJhZnRXYWxsZXRDb25uZWN0ICYmXG4gICAgICBkcmFmdFdhbGxldENvbm5lY3QuZ2V0TGF0ZXN0U2Vzc2lvbigpLnN0YXR1cyA9PT1cbiAgICAgICAgV2FsbGV0Q29ubmVjdFNlc3Npb25TdGF0dXMuQ09OTkVDVEVEXG4gICAgKSB7XG4gICAgICB0aGlzLmVuYWJsZVdhbGxldENvbm5lY3QoZHJhZnRXYWxsZXRDb25uZWN0KTtcbiAgICB9IGVsc2UgaWYgKG51bVNlc3Npb25DaGVjayA9PT0gMCkge1xuICAgICAgbnVtU2Vzc2lvbkNoZWNrICs9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNvbWUgbW9iaWxlIHdhbGxldCBlbXVsYXRlcyB0aGUgYmVoYXZpb3Igb2YgY2hyb21lIGV4dGVuc2lvbi5cbiAgICogSXQgY29uZmlybXMgdGhhdCB0aGUgY3VycmVudCBjb25uZWN0aW9uIGVudmlyb25tZW50IGlzIHN1Y2ggYSB3YWxsZXQuXG4gICAqIChJZiB5b3UgYXJlIHJ1bm5pbmcgY29ubmVjdCgpIGJ5IGNoZWNraW5nIGF2YWlsYWJsZUNvbm5lY3RUeXBlLCB5b3UgZG8gbm90IG5lZWQgdG8gdXNlIHRoaXMgQVBJLilcbiAgICpcbiAgICogQHNlZSBXYWxsZXQjaXNDaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlclxuICAgKi9cbiAgaXNDaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlciA9ICgpOiBib29sZWFuID0+IHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5vcHRpb25zLmRhbmdlcm91c2x5X19jaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlckNoZWNrID8/XG4gICAgICBERUZBVUxUX0NIUk9NRV9FWFRFTlNJT05fQ09NUEFUSUJMRV9CUk9XU0VSX0NIRUNLXG4gICAgKShuYXZpZ2F0b3IudXNlckFnZW50KTtcbiAgfTtcblxuICAvKipcbiAgICogYXZhaWxhYmxlIGNvbm5lY3QgdHlwZXMgb24gdGhlIGJyb3dzZXJcbiAgICpcbiAgICogQHNlZSBXYWxsZXQjYXZhaWxhYmxlQ29ubmVjdFR5cGVzXG4gICAqL1xuICBhdmFpbGFibGVDb25uZWN0VHlwZXMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0VHlwZVtdPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKipcbiAgICogYXZhaWxhYmxlIGNvbm5lY3Rpb25zIGluY2x1ZGVzIGlkZW50aWZpZXIsIG5hbWUsIGljb25cbiAgICpcbiAgICogQHNlZSBXYWxsZXQjYXZhaWxhYmxlQ29ubmVjdGlvbnNcbiAgICovXG4gIGF2YWlsYWJsZUNvbm5lY3Rpb25zID0gKCk6IE9ic2VydmFibGU8Q29ubmVjdGlvbltdPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcy5waXBlKFxuICAgICAgbWFwKChjb25uZWN0VHlwZXMpID0+IHtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbnM6IENvbm5lY3Rpb25bXSA9IFtdO1xuXG4gICAgICAgIGZvciAoY29uc3QgY29ubmVjdFR5cGUgb2YgY29ubmVjdFR5cGVzKSB7XG4gICAgICAgICAgaWYgKGNvbm5lY3RUeXBlID09PSBDb25uZWN0VHlwZS5FWFRFTlNJT04pIHtcbiAgICAgICAgICAgIGNvbnN0IHRlcnJhRXh0ZW5zaW9ucyA9IGdldFRlcnJhRXh0ZW5zaW9ucygpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRlcnJhRXh0ZW5zaW9uIG9mIHRlcnJhRXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgICBjb25uZWN0aW9ucy5wdXNoKFxuICAgICAgICAgICAgICAgIG1lbW9Db25uZWN0aW9uKFxuICAgICAgICAgICAgICAgICAgQ29ubmVjdFR5cGUuRVhURU5TSU9OLFxuICAgICAgICAgICAgICAgICAgdGVycmFFeHRlbnNpb24ubmFtZSxcbiAgICAgICAgICAgICAgICAgIHRlcnJhRXh0ZW5zaW9uLmljb24sXG4gICAgICAgICAgICAgICAgICB0ZXJyYUV4dGVuc2lvbi5pZGVudGlmaWVyLFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbm5lY3Rpb25zLnB1c2goQ09OTkVDVElPTlNbY29ubmVjdFR5cGVdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc29ydENvbm5lY3Rpb25zKGNvbm5lY3Rpb25zKTtcbiAgICAgIH0pLFxuICAgICk7XG4gIH07XG5cbiAgLyoqXG4gICAqIGF2YWlsYWJsZSBpbnN0YWxsIHR5cGVzIG9uIHRoZSBicm93c2VyXG4gICAqXG4gICAqIGluIHRoaXMgdGltZSwgdGhpcyBvbmx5IGNvbnRhaW5zIFtDb25uZWN0VHlwZS5FWFRFTlNJT05dXG4gICAqXG4gICAqIEBzZWUgV2FsbGV0I2F2YWlsYWJsZUluc3RhbGxUeXBlc1xuICAgKi9cbiAgYXZhaWxhYmxlSW5zdGFsbFR5cGVzID0gKCk6IE9ic2VydmFibGU8Q29ubmVjdFR5cGVbXT4gPT4ge1xuICAgIHJldHVybiB0aGlzLl9hdmFpbGFibGVJbnN0YWxsVHlwZXMuYXNPYnNlcnZhYmxlKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIGF2YWlsYWJsZSBpbnN0YWxsYXRpb25zIGluY2x1ZGVzIGlkZW50aWZpZXIsIG5hbWUsIGljb24sIHVybFxuICAgKlxuICAgKiBAc2VlIFdhbGxldCNhdmFpbGFibGVJbnN0YWxsYXRpb25zXG4gICAqL1xuICBhdmFpbGFibGVJbnN0YWxsYXRpb25zID0gKCk6IE9ic2VydmFibGU8SW5zdGFsbGF0aW9uW10+ID0+IHtcbiAgICByZXR1cm4gY29tYmluZUxhdGVzdChbdGhpcy5hdmFpbGFibGVDb25uZWN0aW9ucygpLCBnZXRFeHRlbnNpb25zKCldKS5waXBlKFxuICAgICAgbWFwKChbY29ubmVjdGlvbnMsIGV4dGVuc2lvbnNdKSA9PiB7XG4gICAgICAgIGNvbnN0IGluc3RhbGxlZElkZW50aWZpZXJzID0gbmV3IFNldDxzdHJpbmc+KFxuICAgICAgICAgIGNvbm5lY3Rpb25zXG4gICAgICAgICAgICAuZmlsdGVyKCh7IHR5cGUsIGlkZW50aWZpZXIgfSkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gdHlwZSA9PT0gQ29ubmVjdFR5cGUuRVhURU5TSU9OICYmICEhaWRlbnRpZmllcjtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAubWFwKCh7IGlkZW50aWZpZXIgfSkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gaWRlbnRpZmllciE7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gZXh0ZW5zaW9uc1xuICAgICAgICAgIC5maWx0ZXIoKHsgaWRlbnRpZmllciB9KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gIWluc3RhbGxlZElkZW50aWZpZXJzLmhhcyhpZGVudGlmaWVyKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5tYXAoKHsgbmFtZSwgaWRlbnRpZmllciwgaWNvbiwgdXJsIH0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHR5cGU6IENvbm5lY3RUeXBlLkVYVEVOU0lPTixcbiAgICAgICAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgaWNvbixcbiAgICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pLFxuICAgICk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBzZWUgV2FsbGV0I3N0YXR1c1xuICAgKiBAc2VlIFdhbGxldCNuZXR3b3JrXG4gICAqIEBzZWUgV2FsbGV0I3dhbGxldHNcbiAgICovXG4gIHN0YXRlcyA9ICgpOiBPYnNlcnZhYmxlPFdhbGxldFN0YXRlcz4gPT4ge1xuICAgIHJldHVybiB0aGlzLl9zdGF0ZXMuYXNPYnNlcnZhYmxlKCk7XG4gIH07XG5cbiAgLyoqIGdldCBjb25uZWN0ZWRXYWxsZXQgKi9cbiAgY29ubmVjdGVkV2FsbGV0ID0gKCk6IE9ic2VydmFibGU8Q29ubmVjdGVkV2FsbGV0IHwgdW5kZWZpbmVkPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlcy5waXBlKHRvQ29ubmVjdGVkV2FsbGV0KHRoaXMpKTtcbiAgfTtcblxuICAvKiogZ2V0IGxjZENsaWVudCAqL1xuICBsY2RDbGllbnQgPSAoXG4gICAgbGNkQ2xpZW50Q29uZmlnPzogV2FsbGV0TENEQ2xpZW50Q29uZmlnLFxuICApOiBPYnNlcnZhYmxlPExDRENsaWVudD4gPT4ge1xuICAgIHJldHVybiB0aGlzLl9zdGF0ZXMucGlwZSh0b0xjZENsaWVudChsY2RDbGllbnRDb25maWcpKTtcbiAgfTtcblxuICAvKipcbiAgICogcmVsb2FkIHRoZSBjb25uZWN0ZWQgd2FsbGV0IHN0YXRlc1xuICAgKlxuICAgKiBpbiB0aGlzIHRpbWUsIHRoaXMgb25seSB3b3JrIG9uIHRoZSBDb25uZWN0VHlwZS5FWFRFTlNJT05cbiAgICpcbiAgICogQHNlZSBXYWxsZXQjcmVjaGVja1N0YXR1c1xuICAgKi9cbiAgcmVmZXRjaFN0YXRlcyA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5kaXNhYmxlRXh0ZW5zaW9uKSB7XG4gICAgICB0aGlzLmV4dGVuc2lvbj8ucmVmZXRjaFN0YXRlcygpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWQgUGxlYXNlIHVzZSBhdmFpbGFibGVJbnN0YWxsYXRpb25zXG4gICAqXG4gICAqIGluc3RhbGwgZm9yIHRoZSBjb25uZWN0IHR5cGVcbiAgICpcbiAgICogQHNlZSBXYWxsZXQjaW5zdGFsbFxuICAgKi9cbiAgaW5zdGFsbCA9ICh0eXBlOiBDb25uZWN0VHlwZSkgPT4ge1xuICAgIGlmICh0eXBlID09PSBDb25uZWN0VHlwZS5FWFRFTlNJT04pIHtcbiAgICAgIC8vIFRPRE8gc2VwYXJhdGUgaW5zdGFsbCBsaW5rcyBieSBicm93c2VyIHR5cGVzXG4gICAgICB3aW5kb3cub3BlbihDSFJPTUVfRVhURU5TSU9OX0lOU1RBTExfVVJMLCAnX2JsYW5rJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYFtXYWxsZXRDb250cm9sbGVyXSBDb25uZWN0VHlwZSBcIiR7dHlwZX1cIiBkb2VzIG5vdCBzdXBwb3J0IGluc3RhbGwoKSBmdW5jdGlvbmAsXG4gICAgICApO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogY29ubmVjdCB0byB3YWxsZXRcbiAgICpcbiAgICogQHNlZSBXYWxsZXQjY29ubmVjdFxuICAgKi9cbiAgY29ubmVjdCA9IGFzeW5jIChfdHlwZT86IENvbm5lY3RUeXBlLCBfaWRlbnRpZmllcj86IHN0cmluZykgPT4ge1xuICAgIGxldCB0eXBlOiBDb25uZWN0VHlwZTtcbiAgICBsZXQgaWRlbnRpZmllcjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gICAgaWYgKCEhX3R5cGUpIHtcbiAgICAgIHR5cGUgPSBfdHlwZTtcbiAgICAgIGlkZW50aWZpZXIgPSBfaWRlbnRpZmllcjtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgY29ubmVjdGlvbnMgPSBhd2FpdCBmaXJzdFZhbHVlRnJvbSh0aGlzLmF2YWlsYWJsZUNvbm5lY3Rpb25zKCkpO1xuICAgICAgY29uc3Qgc2VsZWN0b3IgPSB0aGlzLm9wdGlvbnMuc2VsZWN0Q29ubmVjdGlvbiA/PyBzZWxlY3RDb25uZWN0aW9uO1xuICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBhd2FpdCBzZWxlY3Rvcihjb25uZWN0aW9ucyk7XG5cbiAgICAgIGlmICghc2VsZWN0ZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0eXBlID0gc2VsZWN0ZWRbMF07XG4gICAgICBpZGVudGlmaWVyID0gc2VsZWN0ZWRbMV07XG4gICAgfVxuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIENvbm5lY3RUeXBlLlJFQURPTkxZOlxuICAgICAgICBjb25zdCBuZXR3b3JrczogTmV0d29ya0luZm9bXSA9IE9iamVjdC5rZXlzKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy53YWxsZXRDb25uZWN0Q2hhaW5JZHMsXG4gICAgICAgICkubWFwKChjaGFpbklkKSA9PiB0aGlzLm9wdGlvbnMud2FsbGV0Q29ubmVjdENoYWluSWRzWytjaGFpbklkXSk7XG5cbiAgICAgICAgY29uc3QgY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uID1cbiAgICAgICAgICB0aGlzLm9wdGlvbnMuY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uPy4obmV0d29ya3MpID8/XG4gICAgICAgICAgcmVhZG9ubHlXYWxsZXRNb2RhbCh7IG5ldHdvcmtzIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlYWRvbmx5V2FsbGV0U2Vzc2lvbiA9IGF3YWl0IGNyZWF0ZVJlYWRvbmx5V2FsbGV0U2Vzc2lvbjtcblxuICAgICAgICBpZiAocmVhZG9ubHlXYWxsZXRTZXNzaW9uKSB7XG4gICAgICAgICAgdGhpcy5lbmFibGVSZWFkb25seVdhbGxldChyZUNvbm5lY3QocmVhZG9ubHlXYWxsZXRTZXNzaW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1Q6XG4gICAgICAgIHRoaXMuZW5hYmxlV2FsbGV0Q29ubmVjdCh3Y0Nvbm5lY3QodGhpcy5vcHRpb25zKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBDb25uZWN0VHlwZS5FWFRFTlNJT046XG4gICAgICAgIGlmICghdGhpcy5leHRlbnNpb24pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGV4dGVuc2lvbiBpbnN0YW5jZSBpcyBub3QgY3JlYXRlZCFgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmV4dGVuc2lvbi5jb25uZWN0KGlkZW50aWZpZXIpO1xuICAgICAgICB0aGlzLmVuYWJsZUV4dGVuc2lvbigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBDb25uZWN0VHlwZSFgKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIG1hbnVhbCBjb25uZWN0IHRvIHJlYWQgb25seSBzZXNzaW9uXG4gICAqXG4gICAqIEBzZWUgV2FsbGV0I2Nvbm5lY3RSZWFkb25seVxuICAgKi9cbiAgY29ubmVjdFJlYWRvbmx5ID0gKHRlcnJhQWRkcmVzczogc3RyaW5nLCBuZXR3b3JrOiBOZXR3b3JrSW5mbykgPT4ge1xuICAgIHRoaXMuZW5hYmxlUmVhZG9ubHlXYWxsZXQoXG4gICAgICByZUNvbm5lY3Qoe1xuICAgICAgICB0ZXJyYUFkZHJlc3MsXG4gICAgICAgIG5ldHdvcmssXG4gICAgICB9KSxcbiAgICApO1xuICB9O1xuXG4gIC8qKiBAc2VlIFdhbGxldCNkaXNjb25uZWN0ICovXG4gIGRpc2Nvbm5lY3QgPSAoKSA9PiB7XG4gICAgdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXQ/LigpO1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0ID0gbnVsbDtcblxuICAgIHRoaXMuZGlzYWJsZUV4dGVuc2lvbj8uKCk7XG4gICAgdGhpcy5kaXNhYmxlRXh0ZW5zaW9uID0gbnVsbDtcblxuICAgIHRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3Q/LigpO1xuICAgIHRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3QgPSBudWxsO1xuXG4gICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgfTtcblxuICAvKipcbiAgICogQHNlZSBXYWxsZXQjcG9zdFxuICAgKiBAcGFyYW0gdHhcbiAgICogQHBhcmFtIHRlcnJhQWRkcmVzcyBvbmx5IGF2YWlsYWJsZSBuZXcgZXh0ZW5zaW9uXG4gICAqL1xuICBwb3N0ID0gYXN5bmMgKFxuICAgIHR4OiBDcmVhdGVUeE9wdGlvbnMsXG4gICAgdGVycmFBZGRyZXNzPzogc3RyaW5nLFxuICApOiBQcm9taXNlPFR4UmVzdWx0PiA9PiB7XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gZXh0ZW5zaW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgaWYgKHRoaXMuZGlzYWJsZUV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFR4UmVzdWx0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5leHRlbnNpb24pIHtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBleHRlbnNpb24gaW5zdGFuY2Ugbm90IGNyZWF0ZWQhYCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMuZXh0ZW5zaW9uLnBvc3QodHgsIHRlcnJhQWRkcmVzcykuc3Vic2NyaWJlKHtcbiAgICAgICAgICBuZXh0OiAodHhSZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmICh0eFJlc3VsdC5zdGF0dXMgPT09IFdlYkV4dGVuc2lvblR4U3RhdHVzLlNVQ0NFRUQpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgLi4udHgsXG4gICAgICAgICAgICAgICAgcmVzdWx0OiB0eFJlc3VsdC5wYXlsb2FkLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIHJlamVjdChtYXBFeHRlbnNpb25UeEVycm9yKHR4LCBlcnJvcikpO1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gd2FsbGV0IGNvbm5lY3RcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBlbHNlIGlmICh0aGlzLndhbGxldENvbm5lY3QpIHtcbiAgICAgIHJldHVybiB0aGlzLndhbGxldENvbm5lY3RcbiAgICAgICAgLnBvc3QodHgpXG4gICAgICAgIC50aGVuKFxuICAgICAgICAgIChyZXN1bHQpID0+XG4gICAgICAgICAgICAoe1xuICAgICAgICAgICAgICAuLi50eCxcbiAgICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgfSBhcyBUeFJlc3VsdCksXG4gICAgICAgIClcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIHRocm93IG1hcFdhbGxldENvbm5lY3RFcnJvcih0eCwgZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGVyZSBhcmUgbm8gY29ubmVjdGlvbnMgdGhhdCBjYW4gYmUgcG9zdGluZyB0eCFgKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBzZWUgV2FsbGV0I3NpZ25cbiAgICogQHBhcmFtIHR4XG4gICAqIEBwYXJhbSB0ZXJyYUFkZHJlc3Mgb25seSBhdmFpbGFibGUgbmV3IGV4dGVuc2lvblxuICAgKi9cbiAgc2lnbiA9IGFzeW5jIChcbiAgICB0eDogQ3JlYXRlVHhPcHRpb25zLFxuICAgIHRlcnJhQWRkcmVzcz86IHN0cmluZyxcbiAgKTogUHJvbWlzZTxTaWduUmVzdWx0PiA9PiB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZUV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFNpZ25SZXN1bHQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmV4dGVuc2lvbikge1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYGV4dGVuc2lvbiBpbnN0YW5jZSBpcyBub3QgY3JlYXRlZCFgKSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdGhpcy5leHRlbnNpb24uc2lnbih0eCwgdGVycmFBZGRyZXNzKS5zdWJzY3JpYmUoe1xuICAgICAgICAgIG5leHQ6ICh0eFJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHR4UmVzdWx0LnN0YXR1cyA9PT0gV2ViRXh0ZW5zaW9uVHhTdGF0dXMuU1VDQ0VFRCkge1xuICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAuLi50eCxcbiAgICAgICAgICAgICAgICByZXN1bHQ6IFR4LmZyb21EYXRhKHR4UmVzdWx0LnBheWxvYWQpLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIHJlamVjdChtYXBFeHRlbnNpb25UeEVycm9yKHR4LCBlcnJvcikpO1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoYHNpZ24oKSBtZXRob2Qgb25seSBhdmFpbGFibGUgb24gZXh0ZW5zaW9uYCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBzZWUgV2FsbGV0I3NpZ25CeXRlc1xuICAgKiBAcGFyYW0gYnl0ZXNcbiAgICogQHBhcmFtIHRlcnJhQWRkcmVzcyBvbmx5IGF2YWlsYWJsZSBuZXcgZXh0ZW5zaW9uXG4gICAqL1xuICBzaWduQnl0ZXMgPSBhc3luYyAoXG4gICAgYnl0ZXM6IEJ1ZmZlcixcbiAgICB0ZXJyYUFkZHJlc3M/OiBzdHJpbmcsXG4gICk6IFByb21pc2U8U2lnbkJ5dGVzUmVzdWx0PiA9PiB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZUV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFNpZ25CeXRlc1Jlc3VsdD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuZXh0ZW5zaW9uKSB7XG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihgZXh0ZW5zaW9uIGluc3RhbmNlIGlzIG5vdCBjcmVhdGVkIWApKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLmV4dGVuc2lvblxuICAgICAgICAgIC5zaWduQnl0ZXMoYnl0ZXMsIHRlcnJhQWRkcmVzcylcbiAgICAgICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgIG5leHQ6ICh0eFJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICBpZiAodHhSZXN1bHQuc3RhdHVzID09PSBXZWJFeHRlbnNpb25UeFN0YXR1cy5TVUNDRUVEKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICByZXN1bHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgcmVjaWQ6IHR4UmVzdWx0LnBheWxvYWQucmVjaWQsXG4gICAgICAgICAgICAgICAgICAgIHNpZ25hdHVyZTogVWludDhBcnJheS5mcm9tKFxuICAgICAgICAgICAgICAgICAgICAgIEJ1ZmZlci5mcm9tKHR4UmVzdWx0LnBheWxvYWQuc2lnbmF0dXJlLCAnYmFzZTY0JyksXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIHB1YmxpY19rZXk6IHR4UmVzdWx0LnBheWxvYWQucHVibGljX2tleVxuICAgICAgICAgICAgICAgICAgICAgID8gUHVibGljS2V5LmZyb21EYXRhKHR4UmVzdWx0LnBheWxvYWQucHVibGljX2tleSlcbiAgICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICByZWplY3QobWFwRXh0ZW5zaW9uU2lnbkJ5dGVzRXJyb3IoYnl0ZXMsIGVycm9yKSk7XG4gICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgc2lnbkJ5dGVzKCkgbWV0aG9kIG9ubHkgYXZhaWxhYmxlIG9uIGV4dGVuc2lvbmApO1xuICAgIC8vIFRPRE8gaW1wbGVtZW50cyBzaWduQnl0ZXMoKSB0byBvdGhlciBjb25uZWN0IHR5cGVzXG4gIH07XG5cbiAgLyoqXG4gICAqIEBzZWUgV2FsbGV0I2hhc0NXMjBUb2tlbnNcbiAgICogQHBhcmFtIGNoYWluSURcbiAgICogQHBhcmFtIHRva2VuQWRkcnMgVG9rZW4gYWRkcmVzc2VzXG4gICAqL1xuICBoYXNDVzIwVG9rZW5zID0gYXN5bmMgKFxuICAgIGNoYWluSUQ6IHN0cmluZyxcbiAgICAuLi50b2tlbkFkZHJzOiBzdHJpbmdbXVxuICApOiBQcm9taXNlPHsgW3Rva2VuQWRkcjogc3RyaW5nXTogYm9vbGVhbiB9PiA9PiB7XG4gICAgaWYgKHRoaXMuYXZhaWxhYmxlRXh0ZW5zaW9uRmVhdHVyZSgnY3cyMC10b2tlbicpKSB7XG4gICAgICByZXR1cm4gdGhpcy5leHRlbnNpb24hLmhhc0NXMjBUb2tlbnMoY2hhaW5JRCwgLi4udG9rZW5BZGRycyk7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBEb2VzIG5vdCBzdXBwb3J0IGhhc0NXMjBUb2tlbnMoKSBvbiB0aGlzIGNvbm5lY3Rpb25gKTtcbiAgfTtcblxuICAvKipcbiAgICogQHNlZSBXYWxsZXQjYWRkQ1cyMFRva2Vuc1xuICAgKiBAcGFyYW0gY2hhaW5JRFxuICAgKiBAcGFyYW0gdG9rZW5BZGRycyBUb2tlbiBhZGRyZXNzZXNcbiAgICovXG4gIGFkZENXMjBUb2tlbnMgPSBhc3luYyAoXG4gICAgY2hhaW5JRDogc3RyaW5nLFxuICAgIC4uLnRva2VuQWRkcnM6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8eyBbdG9rZW5BZGRyOiBzdHJpbmddOiBib29sZWFuIH0+ID0+IHtcbiAgICBpZiAodGhpcy5hdmFpbGFibGVFeHRlbnNpb25GZWF0dXJlKCdjdzIwLXRva2VuJykpIHtcbiAgICAgIHJldHVybiB0aGlzLmV4dGVuc2lvbiEuYWRkQ1cyMFRva2VucyhjaGFpbklELCAuLi50b2tlbkFkZHJzKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoYERvZXMgbm90IHN1cHBvcnQgYWRkQ1cyMFRva2VucygpIG9uIHRoaXMgY29ubmVjdGlvbmApO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAc2VlIFdhbGxldCNoYXNOZXR3b3JrXG4gICAqIEBwYXJhbSBuZXR3b3JrXG4gICAqL1xuICBoYXNOZXR3b3JrID0gKG5ldHdvcms6IE9taXQ8TmV0d29ya0luZm8sICduYW1lJz4pOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgICBpZiAodGhpcy5hdmFpbGFibGVFeHRlbnNpb25GZWF0dXJlKCduZXR3b3JrJykpIHtcbiAgICAgIHJldHVybiB0aGlzLmV4dGVuc2lvbiEuaGFzTmV0d29yayhuZXR3b3JrKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoYERvZXMgbm90IHN1cHBvcnQgaGFzTmV0d29yaygpIG9uIHRoaXMgY29ubmVjdGlvbmApO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAc2VlIFdhbGxldCNoYXNOZXR3b3JrXG4gICAqIEBwYXJhbSBuZXR3b3JrXG4gICAqL1xuICBhZGROZXR3b3JrID0gKG5ldHdvcms6IE5ldHdvcmtJbmZvKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgaWYgKHRoaXMuYXZhaWxhYmxlRXh0ZW5zaW9uRmVhdHVyZSgnbmV0d29yaycpKSB7XG4gICAgICByZXR1cm4gdGhpcy5leHRlbnNpb24hLmFkZE5ldHdvcmsobmV0d29yayk7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBEb2VzIG5vdCBzdXBwb3J0IGFkZE5ldHdvcmsoKSBvbiB0aGlzIGNvbm5lY3Rpb25gKTtcbiAgfTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIGludGVybmFsXG4gIC8vIGNvbm5lY3QgdHlwZSBjaGFuZ2luZ1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIHByaXZhdGUgYXZhaWxhYmxlRXh0ZW5zaW9uRmVhdHVyZSA9IChmZWF0dXJlOiBUZXJyYVdlYkV4dGVuc2lvbkZlYXR1cmVzKSA9PiB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZUV4dGVuc2lvbiAmJiB0aGlzLmV4dGVuc2lvbikge1xuICAgICAgY29uc3Qgc3RhdGVzID0gdGhpcy5leHRlbnNpb24uZ2V0TGFzdFN0YXRlcygpO1xuXG4gICAgICByZXR1cm4gKFxuICAgICAgICBzdGF0ZXMudHlwZSA9PT0gRXh0ZW5zaW9uUm91dGVyU3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgICAgc3RhdGVzLnN1cHBvcnRGZWF0dXJlcy5oYXMoZmVhdHVyZSlcbiAgICAgICk7XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgdXBkYXRlU3RhdGVzID0gKG5leHQ6IFdhbGxldFN0YXRlcykgPT4ge1xuICAgIGNvbnN0IHByZXYgPSB0aGlzLl9zdGF0ZXMuZ2V0VmFsdWUoKTtcblxuICAgIGlmIChcbiAgICAgIG5leHQuc3RhdHVzID09PSBXYWxsZXRTdGF0dXMuV0FMTEVUX0NPTk5FQ1RFRCAmJlxuICAgICAgbmV4dC53YWxsZXRzLmxlbmd0aCA9PT0gMFxuICAgICkge1xuICAgICAgbmV4dCA9IHtcbiAgICAgICAgc3RhdHVzOiBXYWxsZXRTdGF0dXMuV0FMTEVUX05PVF9DT05ORUNURUQsXG4gICAgICAgIG5ldHdvcms6IG5leHQubmV0d29yayxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHByZXYuc3RhdHVzICE9PSBuZXh0LnN0YXR1cyB8fCAhZGVlcEVxdWFsKHByZXYsIG5leHQpKSB7XG4gICAgICB0aGlzLl9zdGF0ZXMubmV4dChuZXh0KTtcbiAgICB9XG4gIH07XG5cbiAgcHJpdmF0ZSBlbmFibGVSZWFkb25seVdhbGxldCA9IChyZWFkb25seVdhbGxldDogUmVhZG9ubHlXYWxsZXRDb250cm9sbGVyKSA9PiB7XG4gICAgdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdD8uKCk7XG4gICAgdGhpcy5kaXNhYmxlRXh0ZW5zaW9uPy4oKTtcblxuICAgIGlmIChcbiAgICAgIHRoaXMucmVhZG9ubHlXYWxsZXQgPT09IHJlYWRvbmx5V2FsbGV0IHx8XG4gICAgICAodGhpcy5yZWFkb25seVdhbGxldD8udGVycmFBZGRyZXNzID09PSByZWFkb25seVdhbGxldC50ZXJyYUFkZHJlc3MgJiZcbiAgICAgICAgdGhpcy5yZWFkb25seVdhbGxldC5uZXR3b3JrID09PSByZWFkb25seVdhbGxldC5uZXR3b3JrKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlYWRvbmx5V2FsbGV0KSB7XG4gICAgICB0aGlzLnJlYWRvbmx5V2FsbGV0LmRpc2Nvbm5lY3QoKTtcbiAgICB9XG5cbiAgICB0aGlzLnJlYWRvbmx5V2FsbGV0ID0gcmVhZG9ubHlXYWxsZXQ7XG5cbiAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgbmV0d29yazogcmVhZG9ubHlXYWxsZXQubmV0d29yayxcbiAgICAgIHdhbGxldHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNvbm5lY3RUeXBlOiBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgICAgICB0ZXJyYUFkZHJlc3M6IHJlYWRvbmx5V2FsbGV0LnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICBkZXNpZ246ICdyZWFkb25seScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgc3VwcG9ydEZlYXR1cmVzOiBFTVBUWV9TVVBQT1JUX0ZFQVRVUkVTLFxuICAgICAgY29ubmVjdGlvbjogQ09OTkVDVElPTlMuUkVBRE9OTFksXG4gICAgfSk7XG5cbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldCA9ICgpID0+IHtcbiAgICAgIHJlYWRvbmx5V2FsbGV0LmRpc2Nvbm5lY3QoKTtcbiAgICAgIHRoaXMucmVhZG9ubHlXYWxsZXQgPSBudWxsO1xuICAgICAgdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXQgPSBudWxsO1xuICAgIH07XG4gIH07XG5cbiAgcHJpdmF0ZSBlbmFibGVFeHRlbnNpb24gPSAoKSA9PiB7XG4gICAgdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXQ/LigpO1xuICAgIHRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3Q/LigpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZUV4dGVuc2lvbiB8fCAhdGhpcy5leHRlbnNpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb25TdWJzY3JpcHRpb24gPSB0aGlzLmV4dGVuc2lvbi5zdGF0ZXMoKS5zdWJzY3JpYmUoe1xuICAgICAgbmV4dDogKGV4dGVuc2lvblN0YXRlcykgPT4ge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZXh0ZW5zaW9uU3RhdGVzLnR5cGUgPT09IEV4dGVuc2lvblJvdXRlclN0YXR1cy5XQUxMRVRfQ09OTkVDVEVEICYmXG4gICAgICAgICAgQWNjQWRkcmVzcy52YWxpZGF0ZShleHRlbnNpb25TdGF0ZXMud2FsbGV0LnRlcnJhQWRkcmVzcylcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXMoe1xuICAgICAgICAgICAgc3RhdHVzOiBXYWxsZXRTdGF0dXMuV0FMTEVUX0NPTk5FQ1RFRCxcbiAgICAgICAgICAgIG5ldHdvcms6IGV4dGVuc2lvblN0YXRlcy5uZXR3b3JrLFxuICAgICAgICAgICAgd2FsbGV0czogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29ubmVjdFR5cGU6IENvbm5lY3RUeXBlLkVYVEVOU0lPTixcbiAgICAgICAgICAgICAgICB0ZXJyYUFkZHJlc3M6IGV4dGVuc2lvblN0YXRlcy53YWxsZXQudGVycmFBZGRyZXNzLFxuICAgICAgICAgICAgICAgIGRlc2lnbjogZXh0ZW5zaW9uU3RhdGVzLndhbGxldC5kZXNpZ24sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgc3VwcG9ydEZlYXR1cmVzOiBleHRlbnNpb25TdGF0ZXMuc3VwcG9ydEZlYXR1cmVzLFxuICAgICAgICAgICAgY29ubmVjdGlvbjogbWVtb0Nvbm5lY3Rpb24oXG4gICAgICAgICAgICAgIENvbm5lY3RUeXBlLkVYVEVOU0lPTixcbiAgICAgICAgICAgICAgZXh0ZW5zaW9uU3RhdGVzLmV4dGVuc2lvbkluZm8ubmFtZSxcbiAgICAgICAgICAgICAgZXh0ZW5zaW9uU3RhdGVzLmV4dGVuc2lvbkluZm8uaWNvbixcbiAgICAgICAgICAgICAgZXh0ZW5zaW9uU3RhdGVzLmV4dGVuc2lvbkluZm8uaWRlbnRpZmllcixcbiAgICAgICAgICAgICksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuZGlzYWJsZUV4dGVuc2lvbiA9ICgpID0+IHtcbiAgICAgIHRoaXMuZXh0ZW5zaW9uPy5kaXNjb25uZWN0KCk7XG4gICAgICBleHRlbnNpb25TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuZGlzYWJsZUV4dGVuc2lvbiA9IG51bGw7XG4gICAgfTtcbiAgfTtcblxuICBwcml2YXRlIGVuYWJsZVdhbGxldENvbm5lY3QgPSAod2FsbGV0Q29ubmVjdDogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIpID0+IHtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldD8uKCk7XG4gICAgdGhpcy5kaXNhYmxlRXh0ZW5zaW9uPy4oKTtcblxuICAgIGlmICh0aGlzLndhbGxldENvbm5lY3QgPT09IHdhbGxldENvbm5lY3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy53YWxsZXRDb25uZWN0KSB7XG4gICAgICB0aGlzLndhbGxldENvbm5lY3QuZGlzY29ubmVjdCgpO1xuICAgIH1cblxuICAgIHRoaXMud2FsbGV0Q29ubmVjdCA9IHdhbGxldENvbm5lY3Q7XG5cbiAgICBjb25zdCBzdWJzY3JpYmVXYWxsZXRDb25uZWN0ID0gKFxuICAgICAgd2M6IFdhbGxldENvbm5lY3RDb250cm9sbGVyLFxuICAgICk6IFN1YnNjcmlwdGlvbiA9PiB7XG4gICAgICByZXR1cm4gd2Muc2Vzc2lvbigpLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6IChzdGF0dXMpID0+IHtcbiAgICAgICAgICBzd2l0Y2ggKHN0YXR1cy5zdGF0dXMpIHtcbiAgICAgICAgICAgIGNhc2UgV2FsbGV0Q29ubmVjdFNlc3Npb25TdGF0dXMuQ09OTkVDVEVEOlxuICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiBXYWxsZXRTdGF0dXMuV0FMTEVUX0NPTk5FQ1RFRCxcbiAgICAgICAgICAgICAgICBuZXR3b3JrOlxuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLndhbGxldENvbm5lY3RDaGFpbklkc1tzdGF0dXMuY2hhaW5JZF0gPz9cbiAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kZWZhdWx0TmV0d29yayxcbiAgICAgICAgICAgICAgICB3YWxsZXRzOiBbXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3RUeXBlOiBDb25uZWN0VHlwZS5XQUxMRVRDT05ORUNULFxuICAgICAgICAgICAgICAgICAgICB0ZXJyYUFkZHJlc3M6IHN0YXR1cy50ZXJyYUFkZHJlc3MsXG4gICAgICAgICAgICAgICAgICAgIGRlc2lnbjogJ3dhbGxldGNvbm5lY3QnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHN1cHBvcnRGZWF0dXJlczogV0FMTEVUQ09OTkVDVF9TVVBQT1JUX0ZFQVRVUkVTLFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb246IENPTk5FQ1RJT05TLldBTExFVENPTk5FQ1QsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjb25zdCB3YWxsZXRDb25uZWN0U2Vzc2lvblN1YnNjcmlwdGlvbiA9XG4gICAgICBzdWJzY3JpYmVXYWxsZXRDb25uZWN0KHdhbGxldENvbm5lY3QpO1xuXG4gICAgdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdCA9ICgpID0+IHtcbiAgICAgIHRoaXMud2FsbGV0Q29ubmVjdD8uZGlzY29ubmVjdCgpO1xuICAgICAgdGhpcy53YWxsZXRDb25uZWN0ID0gbnVsbDtcbiAgICAgIHdhbGxldENvbm5lY3RTZXNzaW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ID0gbnVsbDtcbiAgICB9O1xuICB9O1xufVxuXG5jb25zdCBtZW1vaXplZENvbm5lY3Rpb25zID0gbmV3IE1hcDxzdHJpbmcsIENvbm5lY3Rpb24+KCk7XG5cbmZ1bmN0aW9uIG1lbW9Db25uZWN0aW9uKFxuICBjb25uZWN0VHlwZTogQ29ubmVjdFR5cGUsXG4gIG5hbWU6IHN0cmluZyxcbiAgaWNvbjogc3RyaW5nLFxuICBpZGVudGlmaWVyOiBzdHJpbmcgfCB1bmRlZmluZWQgPSAnJyxcbik6IENvbm5lY3Rpb24ge1xuICBjb25zdCBrZXkgPSBbY29ubmVjdFR5cGUsIG5hbWUsIGljb24sIGlkZW50aWZpZXJdLmpvaW4oJzsnKTtcblxuICBpZiAobWVtb2l6ZWRDb25uZWN0aW9ucy5oYXMoa2V5KSkge1xuICAgIHJldHVybiBtZW1vaXplZENvbm5lY3Rpb25zLmdldChrZXkpITtcbiAgfVxuXG4gIGNvbnN0IGNvbm5lY3Rpb246IENvbm5lY3Rpb24gPSB7XG4gICAgdHlwZTogY29ubmVjdFR5cGUsXG4gICAgbmFtZSxcbiAgICBpY29uLFxuICAgIGlkZW50aWZpZXIsXG4gIH07XG5cbiAgbWVtb2l6ZWRDb25uZWN0aW9ucy5zZXQoa2V5LCBjb25uZWN0aW9uKTtcblxuICByZXR1cm4gY29ubmVjdGlvbjtcbn1cbiJdfQ==