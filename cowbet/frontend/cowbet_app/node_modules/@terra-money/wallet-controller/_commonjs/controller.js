"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WalletController = void 0;
const terra_js_1 = require("@terra-money/terra.js");
const wallet_types_1 = require("@terra-money/wallet-types");
const web_extension_interface_1 = require("@terra-money/web-extension-interface");
const fast_deep_equal_1 = __importDefault(require("fast-deep-equal"));
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const env_1 = require("./env");
const mapExtensionTxError_1 = require("./exception/mapExtensionTxError");
const mapWalletConnectError_1 = require("./exception/mapWalletConnectError");
const connect_modal_1 = require("./modules/connect-modal");
const extension_router_1 = require("./modules/extension-router");
const multiChannel_1 = require("./modules/extension-router/multiChannel");
const readonly_wallet_1 = require("./modules/readonly-wallet");
const walletconnect_1 = require("./modules/walletconnect");
const getExtensions_1 = require("./operators/getExtensions");
const toConnectedWallet_1 = require("./operators/toConnectedWallet");
const toLcdClient_1 = require("./operators/toLcdClient");
const browser_check_1 = require("./utils/browser-check");
const checkExtensionReady_1 = require("./utils/checkExtensionReady");
const sortConnections_1 = require("./utils/sortConnections");
const CONNECTIONS = {
    [wallet_types_1.ConnectType.READONLY]: {
        type: wallet_types_1.ConnectType.READONLY,
        name: 'View an address',
        icon: 'https://assets.terra.money/icon/wallet-provider/readonly.svg',
    },
    [wallet_types_1.ConnectType.WALLETCONNECT]: {
        type: wallet_types_1.ConnectType.WALLETCONNECT,
        name: 'Wallet Connect',
        icon: 'https://assets.terra.money/icon/wallet-provider/walletconnect.svg',
    },
};
const DEFAULT_WAITING_CHROME_EXTENSION_INSTALL_CHECK = 1000 * 3;
const WALLETCONNECT_SUPPORT_FEATURES = new Set([
    'post',
]);
const EMPTY_SUPPORT_FEATURES = new Set();
//noinspection ES6MissingAwait
class WalletController {
    constructor(options) {
        var _a;
        this.options = options;
        this.extension = null;
        this.walletConnect = null;
        this.readonlyWallet = null;
        this.disableReadonlyWallet = null;
        this.disableExtension = null;
        this.disableWalletConnect = null;
        /**
         * Some mobile wallet emulates the behavior of chrome extension.
         * It confirms that the current connection environment is such a wallet.
         * (If you are running connect() by checking availableConnectType, you do not need to use this API.)
         *
         * @see Wallet#isChromeExtensionCompatibleBrowser
         */
        this.isChromeExtensionCompatibleBrowser = () => {
            var _a;
            return ((_a = this.options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : env_1.DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK)(navigator.userAgent);
        };
        /**
         * available connect types on the browser
         *
         * @see Wallet#availableConnectTypes
         */
        this.availableConnectTypes = () => {
            return this._availableConnectTypes.asObservable();
        };
        /**
         * available connections includes identifier, name, icon
         *
         * @see Wallet#availableConnections
         */
        this.availableConnections = () => {
            return this._availableConnectTypes.pipe((0, operators_1.map)((connectTypes) => {
                const connections = [];
                for (const connectType of connectTypes) {
                    if (connectType === wallet_types_1.ConnectType.EXTENSION) {
                        const terraExtensions = (0, multiChannel_1.getTerraExtensions)();
                        for (const terraExtension of terraExtensions) {
                            connections.push(memoConnection(wallet_types_1.ConnectType.EXTENSION, terraExtension.name, terraExtension.icon, terraExtension.identifier));
                        }
                    }
                    else {
                        connections.push(CONNECTIONS[connectType]);
                    }
                }
                return (0, sortConnections_1.sortConnections)(connections);
            }));
        };
        /**
         * available install types on the browser
         *
         * in this time, this only contains [ConnectType.EXTENSION]
         *
         * @see Wallet#availableInstallTypes
         */
        this.availableInstallTypes = () => {
            return this._availableInstallTypes.asObservable();
        };
        /**
         * available installations includes identifier, name, icon, url
         *
         * @see Wallet#availableInstallations
         */
        this.availableInstallations = () => {
            return (0, rxjs_1.combineLatest)([this.availableConnections(), (0, getExtensions_1.getExtensions)()]).pipe((0, operators_1.map)(([connections, extensions]) => {
                const installedIdentifiers = new Set(connections
                    .filter(({ type, identifier }) => {
                    return type === wallet_types_1.ConnectType.EXTENSION && !!identifier;
                })
                    .map(({ identifier }) => {
                    return identifier;
                }));
                return extensions
                    .filter(({ identifier }) => {
                    return !installedIdentifiers.has(identifier);
                })
                    .map(({ name, identifier, icon, url }) => {
                    return {
                        type: wallet_types_1.ConnectType.EXTENSION,
                        identifier,
                        name,
                        icon,
                        url,
                    };
                });
            }));
        };
        /**
         * @see Wallet#status
         * @see Wallet#network
         * @see Wallet#wallets
         */
        this.states = () => {
            return this._states.asObservable();
        };
        /** get connectedWallet */
        this.connectedWallet = () => {
            return this._states.pipe((0, toConnectedWallet_1.toConnectedWallet)(this));
        };
        /** get lcdClient */
        this.lcdClient = (lcdClientConfig) => {
            return this._states.pipe((0, toLcdClient_1.toLcdClient)(lcdClientConfig));
        };
        /**
         * reload the connected wallet states
         *
         * in this time, this only work on the ConnectType.EXTENSION
         *
         * @see Wallet#recheckStatus
         */
        this.refetchStates = () => {
            var _a;
            if (this.disableExtension) {
                (_a = this.extension) === null || _a === void 0 ? void 0 : _a.refetchStates();
            }
        };
        /**
         * @deprecated Please use availableInstallations
         *
         * install for the connect type
         *
         * @see Wallet#install
         */
        this.install = (type) => {
            if (type === wallet_types_1.ConnectType.EXTENSION) {
                // TODO separate install links by browser types
                window.open(env_1.CHROME_EXTENSION_INSTALL_URL, '_blank');
            }
            else {
                console.warn(`[WalletController] ConnectType "${type}" does not support install() function`);
            }
        };
        /**
         * connect to wallet
         *
         * @see Wallet#connect
         */
        this.connect = async (_type, _identifier) => {
            var _a, _b, _c, _d;
            let type;
            let identifier;
            if (!!_type) {
                type = _type;
                identifier = _identifier;
            }
            else {
                const connections = await (0, rxjs_1.firstValueFrom)(this.availableConnections());
                const selector = (_a = this.options.selectConnection) !== null && _a !== void 0 ? _a : connect_modal_1.selectConnection;
                const selected = await selector(connections);
                if (!selected) {
                    return;
                }
                type = selected[0];
                identifier = selected[1];
            }
            switch (type) {
                case wallet_types_1.ConnectType.READONLY:
                    const networks = Object.keys(this.options.walletConnectChainIds).map((chainId) => this.options.walletConnectChainIds[+chainId]);
                    const createReadonlyWalletSession = (_d = (_c = (_b = this.options).createReadonlyWalletSession) === null || _c === void 0 ? void 0 : _c.call(_b, networks)) !== null && _d !== void 0 ? _d : (0, readonly_wallet_1.readonlyWalletModal)({ networks });
                    const readonlyWalletSession = await createReadonlyWalletSession;
                    if (readonlyWalletSession) {
                        this.enableReadonlyWallet((0, readonly_wallet_1.connect)(readonlyWalletSession));
                    }
                    break;
                case wallet_types_1.ConnectType.WALLETCONNECT:
                    this.enableWalletConnect((0, walletconnect_1.connect)(this.options));
                    break;
                case wallet_types_1.ConnectType.EXTENSION:
                    if (!this.extension) {
                        throw new Error(`extension instance is not created!`);
                    }
                    this.extension.connect(identifier);
                    this.enableExtension();
                    break;
                default:
                    throw new Error(`Unknown ConnectType!`);
            }
        };
        /**
         * manual connect to read only session
         *
         * @see Wallet#connectReadonly
         */
        this.connectReadonly = (terraAddress, network) => {
            this.enableReadonlyWallet((0, readonly_wallet_1.connect)({
                terraAddress,
                network,
            }));
        };
        /** @see Wallet#disconnect */
        this.disconnect = () => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            this.disableReadonlyWallet = null;
            (_b = this.disableExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            this.disableExtension = null;
            (_c = this.disableWalletConnect) === null || _c === void 0 ? void 0 : _c.call(this);
            this.disableWalletConnect = null;
            this.updateStates(this._notConnected);
        };
        /**
         * @see Wallet#post
         * @param tx
         * @param terraAddress only available new extension
         */
        this.post = async (tx, terraAddress) => {
            // ---------------------------------------------
            // extension
            // ---------------------------------------------
            if (this.disableExtension) {
                return new Promise((resolve, reject) => {
                    if (!this.extension) {
                        reject(new Error(`extension instance not created!`));
                        return;
                    }
                    const subscription = this.extension.post(tx, terraAddress).subscribe({
                        next: (txResult) => {
                            if (txResult.status === web_extension_interface_1.WebExtensionTxStatus.SUCCEED) {
                                resolve({
                                    ...tx,
                                    result: txResult.payload,
                                    success: true,
                                });
                                subscription.unsubscribe();
                            }
                        },
                        error: (error) => {
                            reject((0, mapExtensionTxError_1.mapExtensionTxError)(tx, error));
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            // ---------------------------------------------
            // wallet connect
            // ---------------------------------------------
            else if (this.walletConnect) {
                return this.walletConnect
                    .post(tx)
                    .then((result) => ({
                    ...tx,
                    result,
                    success: true,
                }))
                    .catch((error) => {
                    throw (0, mapWalletConnectError_1.mapWalletConnectError)(tx, error);
                });
            }
            else {
                throw new Error(`There are no connections that can be posting tx!`);
            }
        };
        /**
         * @see Wallet#sign
         * @param tx
         * @param terraAddress only available new extension
         */
        this.sign = async (tx, terraAddress) => {
            if (this.disableExtension) {
                return new Promise((resolve, reject) => {
                    if (!this.extension) {
                        reject(new Error(`extension instance is not created!`));
                        return;
                    }
                    const subscription = this.extension.sign(tx, terraAddress).subscribe({
                        next: (txResult) => {
                            if (txResult.status === web_extension_interface_1.WebExtensionTxStatus.SUCCEED) {
                                resolve({
                                    ...tx,
                                    result: terra_js_1.Tx.fromData(txResult.payload),
                                    success: true,
                                });
                                subscription.unsubscribe();
                            }
                        },
                        error: (error) => {
                            reject((0, mapExtensionTxError_1.mapExtensionTxError)(tx, error));
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            throw new Error(`sign() method only available on extension`);
        };
        /**
         * @see Wallet#signBytes
         * @param bytes
         * @param terraAddress only available new extension
         */
        this.signBytes = async (bytes, terraAddress) => {
            if (this.disableExtension) {
                return new Promise((resolve, reject) => {
                    if (!this.extension) {
                        reject(new Error(`extension instance is not created!`));
                        return;
                    }
                    const subscription = this.extension
                        .signBytes(bytes, terraAddress)
                        .subscribe({
                        next: (txResult) => {
                            if (txResult.status === web_extension_interface_1.WebExtensionTxStatus.SUCCEED) {
                                resolve({
                                    result: {
                                        recid: txResult.payload.recid,
                                        signature: Uint8Array.from(Buffer.from(txResult.payload.signature, 'base64')),
                                        public_key: txResult.payload.public_key
                                            ? terra_js_1.PublicKey.fromData(txResult.payload.public_key)
                                            : undefined,
                                    },
                                    success: true,
                                });
                                subscription.unsubscribe();
                            }
                        },
                        error: (error) => {
                            reject((0, mapExtensionTxError_1.mapExtensionSignBytesError)(bytes, error));
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            throw new Error(`signBytes() method only available on extension`);
            // TODO implements signBytes() to other connect types
        };
        /**
         * @see Wallet#hasCW20Tokens
         * @param chainID
         * @param tokenAddrs Token addresses
         */
        this.hasCW20Tokens = async (chainID, ...tokenAddrs) => {
            if (this.availableExtensionFeature('cw20-token')) {
                return this.extension.hasCW20Tokens(chainID, ...tokenAddrs);
            }
            throw new Error(`Does not support hasCW20Tokens() on this connection`);
        };
        /**
         * @see Wallet#addCW20Tokens
         * @param chainID
         * @param tokenAddrs Token addresses
         */
        this.addCW20Tokens = async (chainID, ...tokenAddrs) => {
            if (this.availableExtensionFeature('cw20-token')) {
                return this.extension.addCW20Tokens(chainID, ...tokenAddrs);
            }
            throw new Error(`Does not support addCW20Tokens() on this connection`);
        };
        /**
         * @see Wallet#hasNetwork
         * @param network
         */
        this.hasNetwork = (network) => {
            if (this.availableExtensionFeature('network')) {
                return this.extension.hasNetwork(network);
            }
            throw new Error(`Does not support hasNetwork() on this connection`);
        };
        /**
         * @see Wallet#hasNetwork
         * @param network
         */
        this.addNetwork = (network) => {
            if (this.availableExtensionFeature('network')) {
                return this.extension.addNetwork(network);
            }
            throw new Error(`Does not support addNetwork() on this connection`);
        };
        // ================================================================
        // internal
        // connect type changing
        // ================================================================
        this.availableExtensionFeature = (feature) => {
            if (this.disableExtension && this.extension) {
                const states = this.extension.getLastStates();
                return (states.type === extension_router_1.ExtensionRouterStatus.WALLET_CONNECTED &&
                    states.supportFeatures.has(feature));
            }
        };
        this.updateStates = (next) => {
            const prev = this._states.getValue();
            if (next.status === wallet_types_1.WalletStatus.WALLET_CONNECTED &&
                next.wallets.length === 0) {
                next = {
                    status: wallet_types_1.WalletStatus.WALLET_NOT_CONNECTED,
                    network: next.network,
                };
            }
            if (prev.status !== next.status || !(0, fast_deep_equal_1.default)(prev, next)) {
                this._states.next(next);
            }
        };
        this.enableReadonlyWallet = (readonlyWallet) => {
            var _a, _b, _c;
            (_a = this.disableWalletConnect) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            if (this.readonlyWallet === readonlyWallet ||
                (((_c = this.readonlyWallet) === null || _c === void 0 ? void 0 : _c.terraAddress) === readonlyWallet.terraAddress &&
                    this.readonlyWallet.network === readonlyWallet.network)) {
                return;
            }
            if (this.readonlyWallet) {
                this.readonlyWallet.disconnect();
            }
            this.readonlyWallet = readonlyWallet;
            this.updateStates({
                status: wallet_types_1.WalletStatus.WALLET_CONNECTED,
                network: readonlyWallet.network,
                wallets: [
                    {
                        connectType: wallet_types_1.ConnectType.READONLY,
                        terraAddress: readonlyWallet.terraAddress,
                        design: 'readonly',
                    },
                ],
                supportFeatures: EMPTY_SUPPORT_FEATURES,
                connection: CONNECTIONS.READONLY,
            });
            this.disableReadonlyWallet = () => {
                readonlyWallet.disconnect();
                this.readonlyWallet = null;
                this.disableReadonlyWallet = null;
            };
        };
        this.enableExtension = () => {
            var _a, _b;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableWalletConnect) === null || _b === void 0 ? void 0 : _b.call(this);
            if (this.disableExtension || !this.extension) {
                return;
            }
            const extensionSubscription = this.extension.states().subscribe({
                next: (extensionStates) => {
                    if (extensionStates.type === extension_router_1.ExtensionRouterStatus.WALLET_CONNECTED &&
                        terra_js_1.AccAddress.validate(extensionStates.wallet.terraAddress)) {
                        this.updateStates({
                            status: wallet_types_1.WalletStatus.WALLET_CONNECTED,
                            network: extensionStates.network,
                            wallets: [
                                {
                                    connectType: wallet_types_1.ConnectType.EXTENSION,
                                    terraAddress: extensionStates.wallet.terraAddress,
                                    design: extensionStates.wallet.design,
                                },
                            ],
                            supportFeatures: extensionStates.supportFeatures,
                            connection: memoConnection(wallet_types_1.ConnectType.EXTENSION, extensionStates.extensionInfo.name, extensionStates.extensionInfo.icon, extensionStates.extensionInfo.identifier),
                        });
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                },
            });
            this.disableExtension = () => {
                var _a;
                (_a = this.extension) === null || _a === void 0 ? void 0 : _a.disconnect();
                extensionSubscription.unsubscribe();
                this.disableExtension = null;
            };
        };
        this.enableWalletConnect = (walletConnect) => {
            var _a, _b;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            if (this.walletConnect === walletConnect) {
                return;
            }
            if (this.walletConnect) {
                this.walletConnect.disconnect();
            }
            this.walletConnect = walletConnect;
            const subscribeWalletConnect = (wc) => {
                return wc.session().subscribe({
                    next: (status) => {
                        var _a;
                        switch (status.status) {
                            case walletconnect_1.WalletConnectSessionStatus.CONNECTED:
                                this.updateStates({
                                    status: wallet_types_1.WalletStatus.WALLET_CONNECTED,
                                    network: (_a = this.options.walletConnectChainIds[status.chainId]) !== null && _a !== void 0 ? _a : this.options.defaultNetwork,
                                    wallets: [
                                        {
                                            connectType: wallet_types_1.ConnectType.WALLETCONNECT,
                                            terraAddress: status.terraAddress,
                                            design: 'walletconnect',
                                        },
                                    ],
                                    supportFeatures: WALLETCONNECT_SUPPORT_FEATURES,
                                    connection: CONNECTIONS.WALLETCONNECT,
                                });
                                break;
                            default:
                                this.updateStates(this._notConnected);
                                break;
                        }
                    },
                });
            };
            const walletConnectSessionSubscription = subscribeWalletConnect(walletConnect);
            this.disableWalletConnect = () => {
                var _a;
                (_a = this.walletConnect) === null || _a === void 0 ? void 0 : _a.disconnect();
                this.walletConnect = null;
                walletConnectSessionSubscription.unsubscribe();
                this.disableWalletConnect = null;
            };
        };
        this._notConnected = {
            status: wallet_types_1.WalletStatus.WALLET_NOT_CONNECTED,
            network: options.defaultNetwork,
        };
        this._initializing = {
            status: wallet_types_1.WalletStatus.INITIALIZING,
            network: options.defaultNetwork,
        };
        this._availableConnectTypes = new rxjs_1.BehaviorSubject([
            wallet_types_1.ConnectType.READONLY,
            wallet_types_1.ConnectType.WALLETCONNECT,
        ]);
        this._availableInstallTypes = new rxjs_1.BehaviorSubject([]);
        this._states = new rxjs_1.BehaviorSubject(this._initializing);
        let numSessionCheck = 0;
        // wait checking the availability of the chrome extension
        // 0. check if extension wallet session is exists
        (0, checkExtensionReady_1.checkExtensionReady)((_a = options.waitingChromeExtensionInstallCheck) !== null && _a !== void 0 ? _a : DEFAULT_WAITING_CHROME_EXTENSION_INSTALL_CHECK, this.isChromeExtensionCompatibleBrowser()).then((ready) => {
            var _a;
            if (ready) {
                this._availableConnectTypes.next([
                    wallet_types_1.ConnectType.EXTENSION,
                    wallet_types_1.ConnectType.WALLETCONNECT,
                    wallet_types_1.ConnectType.READONLY,
                ]);
                this.extension = new extension_router_1.ExtensionRouter({
                    hostWindow: window,
                    selectExtension: options.selectExtension,
                    dangerously__chromeExtensionCompatibleBrowserCheck: (_a = options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : env_1.DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK,
                    defaultNetwork: options.defaultNetwork,
                });
                const subscription = this.extension
                    .states()
                    .pipe((0, operators_1.filter)(({ type }) => type !== extension_router_1.ExtensionRouterStatus.INITIALIZING))
                    .subscribe((extensionStates) => {
                    try {
                        subscription.unsubscribe();
                    }
                    catch (_a) { }
                    if (extensionStates.type === extension_router_1.ExtensionRouterStatus.WALLET_CONNECTED &&
                        !this.disableWalletConnect &&
                        !this.disableReadonlyWallet) {
                        this.enableExtension();
                    }
                    else if (numSessionCheck === 0) {
                        numSessionCheck += 1;
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                });
            }
            else {
                if ((0, browser_check_1.isDesktopChrome)(this.isChromeExtensionCompatibleBrowser())) {
                    this._availableInstallTypes.next([wallet_types_1.ConnectType.EXTENSION]);
                }
                if (numSessionCheck === 0) {
                    numSessionCheck += 1;
                }
                else {
                    this.updateStates(this._notConnected);
                }
            }
        });
        // 1. check if readonly wallet session is exists
        const draftReadonlyWallet = (0, readonly_wallet_1.connectIfSessionExists)();
        if (draftReadonlyWallet) {
            this.enableReadonlyWallet(draftReadonlyWallet);
            return;
        }
        // 2. check if walletconnect sesison is exists
        const draftWalletConnect = (0, walletconnect_1.connectIfSessionExists)(options);
        if (draftWalletConnect &&
            draftWalletConnect.getLatestSession().status ===
                walletconnect_1.WalletConnectSessionStatus.CONNECTED) {
            this.enableWalletConnect(draftWalletConnect);
        }
        else if (numSessionCheck === 0) {
            numSessionCheck += 1;
        }
        else {
            this.updateStates(this._notConnected);
        }
    }
}
exports.WalletController = WalletController;
const memoizedConnections = new Map();
function memoConnection(connectType, name, icon, identifier = '') {
    const key = [connectType, name, icon, identifier].join(';');
    if (memoizedConnections.has(key)) {
        return memoizedConnections.get(key);
    }
    const connection = {
        type: connectType,
        name,
        icon,
        identifier,
    };
    memoizedConnections.set(key, connection);
    return connection;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9AdGVycmEtbW9uZXkvd2FsbGV0LWNvbnRyb2xsZXIvY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxvREFNK0I7QUFDL0IsNERBWW1DO0FBQ25DLGtGQUc4QztBQUM5QyxzRUFBd0M7QUFDeEMsK0JBTWM7QUFDZCw4Q0FBNkM7QUFDN0MsK0JBR2U7QUFDZix5RUFHeUM7QUFDekMsNkVBQTBFO0FBQzFFLDJEQUEyRDtBQUMzRCxpRUFHb0M7QUFDcEMsMEVBR2lEO0FBQ2pELCtEQU1tQztBQUNuQywyREFNaUM7QUFDakMsNkRBQTBEO0FBQzFELHFFQUFrRTtBQUNsRSx5REFBc0Q7QUFDdEQseURBQXdEO0FBQ3hELHFFQUFrRTtBQUNsRSw2REFBMEQ7QUF3RjFELE1BQU0sV0FBVyxHQUFHO0lBQ2xCLENBQUMsMEJBQVcsQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUN0QixJQUFJLEVBQUUsMEJBQVcsQ0FBQyxRQUFRO1FBQzFCLElBQUksRUFBRSxpQkFBaUI7UUFDdkIsSUFBSSxFQUFFLDhEQUE4RDtLQUN2RDtJQUNmLENBQUMsMEJBQVcsQ0FBQyxhQUFhLENBQUMsRUFBRTtRQUMzQixJQUFJLEVBQUUsMEJBQVcsQ0FBQyxhQUFhO1FBQy9CLElBQUksRUFBRSxnQkFBZ0I7UUFDdEIsSUFBSSxFQUFFLG1FQUFtRTtLQUM1RDtDQUNQLENBQUM7QUFFWCxNQUFNLDhDQUE4QyxHQUFHLElBQUksR0FBRyxDQUFDLENBQUM7QUFFaEUsTUFBTSw4QkFBOEIsR0FBRyxJQUFJLEdBQUcsQ0FBNEI7SUFDeEUsTUFBTTtDQUNQLENBQUMsQ0FBQztBQUVILE1BQU0sc0JBQXNCLEdBQUcsSUFBSSxHQUFHLEVBQTZCLENBQUM7QUFFcEUsOEJBQThCO0FBQzlCLE1BQWEsZ0JBQWdCO0lBZ0IzQixZQUFxQixPQUFnQzs7UUFBaEMsWUFBTyxHQUFQ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O0lBQ0gsQ0FBQztDQXNtQkY7QUE1dEJELDRDQTR0QkM7QUFFRCxNQUFNLG1CQUFtQixHQUFHLElBQUksR0FBRyxFQUFzQixDQUFDO0FBRTFELFNBQVMsY0FBYyxDQUNyQixXQUF3QixFQUN4QixJQUFZLEVBQ1osSUFBWSxFQUNaLGFBQWlDLEVBQUU7SUFFbkMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFNUQsSUFBSSxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDaEMsT0FBTyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFFLENBQUM7S0FDdEM7SUFFRCxNQUFNLFVBQVUsR0FBZTtRQUM3QixJQUFJLEVBQUUsV0FBVztRQUNqQixJQUFJO1FBQ0osSUFBSTtRQUNKLFVBQVU7S0FDWCxDQUFDO0lBRUYsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUV6QyxPQUFPLFVBQVUsQ0FBQztBQUNwQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWNjQWRkcmVzcyxcbiAgQ3JlYXRlVHhPcHRpb25zLFxuICBMQ0RDbGllbnQsXG4gIFB1YmxpY0tleSxcbiAgVHgsXG59IGZyb20gJ0B0ZXJyYS1tb25leS90ZXJyYS5qcyc7XG5pbXBvcnQge1xuICBDb25uZWN0ZWRXYWxsZXQsXG4gIENvbm5lY3Rpb24sXG4gIENvbm5lY3RUeXBlLFxuICBJbnN0YWxsYXRpb24sXG4gIE5ldHdvcmtJbmZvLFxuICBTaWduQnl0ZXNSZXN1bHQsXG4gIFNpZ25SZXN1bHQsXG4gIFR4UmVzdWx0LFxuICBXYWxsZXRMQ0RDbGllbnRDb25maWcsXG4gIFdhbGxldFN0YXRlcyxcbiAgV2FsbGV0U3RhdHVzLFxufSBmcm9tICdAdGVycmEtbW9uZXkvd2FsbGV0LXR5cGVzJztcbmltcG9ydCB7XG4gIFRlcnJhV2ViRXh0ZW5zaW9uRmVhdHVyZXMsXG4gIFdlYkV4dGVuc2lvblR4U3RhdHVzLFxufSBmcm9tICdAdGVycmEtbW9uZXkvd2ViLWV4dGVuc2lvbi1pbnRlcmZhY2UnO1xuaW1wb3J0IGRlZXBFcXVhbCBmcm9tICdmYXN0LWRlZXAtZXF1YWwnO1xuaW1wb3J0IHtcbiAgQmVoYXZpb3JTdWJqZWN0LFxuICBjb21iaW5lTGF0ZXN0LFxuICBmaXJzdFZhbHVlRnJvbSxcbiAgT2JzZXJ2YWJsZSxcbiAgU3Vic2NyaXB0aW9uLFxufSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgQ0hST01FX0VYVEVOU0lPTl9JTlNUQUxMX1VSTCxcbiAgREVGQVVMVF9DSFJPTUVfRVhURU5TSU9OX0NPTVBBVElCTEVfQlJPV1NFUl9DSEVDSyxcbn0gZnJvbSAnLi9lbnYnO1xuaW1wb3J0IHtcbiAgbWFwRXh0ZW5zaW9uU2lnbkJ5dGVzRXJyb3IsXG4gIG1hcEV4dGVuc2lvblR4RXJyb3IsXG59IGZyb20gJy4vZXhjZXB0aW9uL21hcEV4dGVuc2lvblR4RXJyb3InO1xuaW1wb3J0IHsgbWFwV2FsbGV0Q29ubmVjdEVycm9yIH0gZnJvbSAnLi9leGNlcHRpb24vbWFwV2FsbGV0Q29ubmVjdEVycm9yJztcbmltcG9ydCB7IHNlbGVjdENvbm5lY3Rpb24gfSBmcm9tICcuL21vZHVsZXMvY29ubmVjdC1tb2RhbCc7XG5pbXBvcnQge1xuICBFeHRlbnNpb25Sb3V0ZXIsXG4gIEV4dGVuc2lvblJvdXRlclN0YXR1cyxcbn0gZnJvbSAnLi9tb2R1bGVzL2V4dGVuc2lvbi1yb3V0ZXInO1xuaW1wb3J0IHtcbiAgRXh0ZW5zaW9uSW5mbyxcbiAgZ2V0VGVycmFFeHRlbnNpb25zLFxufSBmcm9tICcuL21vZHVsZXMvZXh0ZW5zaW9uLXJvdXRlci9tdWx0aUNoYW5uZWwnO1xuaW1wb3J0IHtcbiAgY29ubmVjdCBhcyByZUNvbm5lY3QsXG4gIGNvbm5lY3RJZlNlc3Npb25FeGlzdHMgYXMgcmVDb25uZWN0SWZTZXNzaW9uRXhpc3RzLFxuICBSZWFkb25seVdhbGxldENvbnRyb2xsZXIsXG4gIHJlYWRvbmx5V2FsbGV0TW9kYWwsXG4gIFJlYWRvbmx5V2FsbGV0U2Vzc2lvbixcbn0gZnJvbSAnLi9tb2R1bGVzL3JlYWRvbmx5LXdhbGxldCc7XG5pbXBvcnQge1xuICBjb25uZWN0IGFzIHdjQ29ubmVjdCxcbiAgY29ubmVjdElmU2Vzc2lvbkV4aXN0cyBhcyB3Y0Nvbm5lY3RJZlNlc3Npb25FeGlzdHMsXG4gIFdhbGxldENvbm5lY3RDb250cm9sbGVyLFxuICBXYWxsZXRDb25uZWN0Q29udHJvbGxlck9wdGlvbnMsXG4gIFdhbGxldENvbm5lY3RTZXNzaW9uU3RhdHVzLFxufSBmcm9tICcuL21vZHVsZXMvd2FsbGV0Y29ubmVjdCc7XG5pbXBvcnQgeyBnZXRFeHRlbnNpb25zIH0gZnJvbSAnLi9vcGVyYXRvcnMvZ2V0RXh0ZW5zaW9ucyc7XG5pbXBvcnQgeyB0b0Nvbm5lY3RlZFdhbGxldCB9IGZyb20gJy4vb3BlcmF0b3JzL3RvQ29ubmVjdGVkV2FsbGV0JztcbmltcG9ydCB7IHRvTGNkQ2xpZW50IH0gZnJvbSAnLi9vcGVyYXRvcnMvdG9MY2RDbGllbnQnO1xuaW1wb3J0IHsgaXNEZXNrdG9wQ2hyb21lIH0gZnJvbSAnLi91dGlscy9icm93c2VyLWNoZWNrJztcbmltcG9ydCB7IGNoZWNrRXh0ZW5zaW9uUmVhZHkgfSBmcm9tICcuL3V0aWxzL2NoZWNrRXh0ZW5zaW9uUmVhZHknO1xuaW1wb3J0IHsgc29ydENvbm5lY3Rpb25zIH0gZnJvbSAnLi91dGlscy9zb3J0Q29ubmVjdGlvbnMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFdhbGxldENvbnRyb2xsZXJPcHRpb25zXG4gIGV4dGVuZHMgV2FsbGV0Q29ubmVjdENvbnRyb2xsZXJPcHRpb25zIHtcbiAgLyoqXG4gICAqIOKaoO+4jyBEb24ndCBoYXJkY29kaW5nIHRoaXMsIHVzZSBnZXRDaGFpbiBPcHRpb25zKClcbiAgICpcbiAgICogZmFsbGJhY2sgbmV0d29yayBpZiBjb250cm9sbGVyIGlzIG5vdCBjb25uZWN0ZWRcbiAgICovXG4gIGRlZmF1bHROZXR3b3JrOiBOZXR3b3JrSW5mbztcblxuICAvKipcbiAgICog4pqg77iPIERvbid0IGhhcmRjb2RpbmcgdGhpcywgdXNlIGdldENoYWluIE9wdGlvbnMoKVxuICAgKlxuICAgKiBmb3Igd2FsbGV0Y29ubmVjdFxuICAgKlxuICAgKiBUaGUgbmV0d29yayBydWxlcyBwYXNzZWQgYnkgdGhlIFRlcnJhIFN0YXRpb24gTW9iaWxlIGFyZSAwIGlzIHRlc3RuZXQsIDEgaXMgbWFpbm5ldC5cbiAgICpcbiAgICogQWx3YXlzIHNldCB0ZXN0bmV0IGZvciAwIGFuZCBtYWlubmV0IGZvciAxLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBcbiAgICogY29uc3QgbWFpbm5ldDogTmV0d29ya0luZm8gPSB7XG4gICAqICBuYW1lOiAnbWFpbm5ldCcsXG4gICAqICBjaGFpbklEOiAnY29sdW1idXMtNScsXG4gICAqICBsY2Q6ICdodHRwczovL2xjZC50ZXJyYS5kZXYnLFxuICAgKiB9XG4gICAqXG4gICAqIGNvbnN0IHRlc3RuZXQ6IE5ldHdvcmtJbmZvID0ge1xuICAgKiAgbmFtZTogJ3Rlc3RuZXQnLFxuICAgKiAgY2hhaW5JRDogJ2JvbWJheS0xMicsXG4gICAqICBsY2Q6ICdodHRwczovL2JvbWJheS1sY2QudGVycmEuZGV2JyxcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB3YWxsZXRDb25uZWN0Q2hhaW5JZHM6IFJlY29yZDxudW1iZXIsIE5ldHdvcmtJbmZvPiA9IHtcbiAgICogICAwOiB0ZXN0bmV0LFxuICAgKiAgIDE6IG1haW5uZXQsXG4gICAqIH1cbiAgICpcbiAgICogPFdhbGxldFByb3ZpZGVyIHdhbGxldENvbm5lY3RDaGFpbklkcz17d2FsbGV0Q29ubmVjdENoYWluSWRzfT5cbiAgICogYGBgXG4gICAqL1xuICB3YWxsZXRDb25uZWN0Q2hhaW5JZHM6IFJlY29yZDxudW1iZXIsIE5ldHdvcmtJbmZvPjtcblxuICAvKipcbiAgICogcnVuIGF0IGV4ZWN1dGluZyB0aGUgYGNvbm5lY3QoQ29ubmVjdFR5cGUuUkVBRE9OTFkpYFxuICAgKi9cbiAgY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uPzogKFxuICAgIG5ldHdvcmtzOiBOZXR3b3JrSW5mb1tdLFxuICApID0+IFByb21pc2U8UmVhZG9ubHlXYWxsZXRTZXNzaW9uIHwgbnVsbD47XG5cbiAgLyoqXG4gICAqIHJ1biBhdCBleGVjdXRpbmcgdGhlIGBjb25uZWN0KClgIC0gb25seSB1c2VkIHdoZW4gZG9lcyBub3QgaW5wdXQgQ29ubmVjdFR5cGVcbiAgICovXG4gIHNlbGVjdENvbm5lY3Rpb24/OiAoXG4gICAgY29ubmVjdGlvbnM6IENvbm5lY3Rpb25bXSxcbiAgKSA9PiBQcm9taXNlPFt0eXBlOiBDb25uZWN0VHlwZSwgaWRlbnRpZmllcjogc3RyaW5nIHwgdW5kZWZpbmVkXSB8IG51bGw+O1xuXG4gIC8qKlxuICAgKiBydW4gYXQgZXhlY3V0aW5nIHRoZSBgY29ubmVjdChDb25uZWN0VHlwZS5FWFRFTlNJT04pYFxuICAgKiBpZiB1c2VyIGluc3RhbGxlZCBtdWx0aXBsZSB3YWxsZXRzXG4gICAqL1xuICBzZWxlY3RFeHRlbnNpb24/OiAoXG4gICAgZXh0ZW5zaW9uSW5mb3M6IEV4dGVuc2lvbkluZm9bXSxcbiAgKSA9PiBQcm9taXNlPEV4dGVuc2lvbkluZm8gfCBudWxsPjtcblxuICAvKipcbiAgICogbWlsbGlzZWNvbmRzIHRvIHdhaXQgY2hlY2tpbmcgY2hyb21lIGV4dGVuc2lvbiBpcyBpbnN0YWxsZWRcbiAgICpcbiAgICogQGRlZmF1bHQgMTAwMCAqIDMgbWlsaXNlY29uZHNcbiAgICovXG4gIHdhaXRpbmdDaHJvbWVFeHRlbnNpb25JbnN0YWxsQ2hlY2s/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIOKaoO+4jyBUaGlzIEFQSSBpcyBhbiBvcHRpb24gZm9yIHdhbGxldCBkZXZlbG9wZXJzLiBQbGVhc2UgZG9uJ3QgdXNlIGRBcHAgZGV2ZWxvcGVycy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgXG4gICAqIDxXYWxsZXRQcm92aWRlciBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjaz17KHVzZXJBZ2VudDogc3RyaW5nKSA9PiB7XG4gICAqICAgcmV0dXJuIC9NeVdhbGxldFxcLy8udGVzdCh1c2VyQWdlbnQpO1xuICAgKiB9fT5cbiAgICogYGBgXG4gICAqL1xuICBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjaz86IChcbiAgICB1c2VyQWdlbnQ6IHN0cmluZyxcbiAgKSA9PiBib29sZWFuO1xufVxuXG5jb25zdCBDT05ORUNUSU9OUyA9IHtcbiAgW0Nvbm5lY3RUeXBlLlJFQURPTkxZXToge1xuICAgIHR5cGU6IENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgIG5hbWU6ICdWaWV3IGFuIGFkZHJlc3MnLFxuICAgIGljb246ICdodHRwczovL2Fzc2V0cy50ZXJyYS5tb25leS9pY29uL3dhbGxldC1wcm92aWRlci9yZWFkb25seS5zdmcnLFxuICB9IGFzIENvbm5lY3Rpb24sXG4gIFtDb25uZWN0VHlwZS5XQUxMRVRDT05ORUNUXToge1xuICAgIHR5cGU6IENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgbmFtZTogJ1dhbGxldCBDb25uZWN0JyxcbiAgICBpY29uOiAnaHR0cHM6Ly9hc3NldHMudGVycmEubW9uZXkvaWNvbi93YWxsZXQtcHJvdmlkZXIvd2FsbGV0Y29ubmVjdC5zdmcnLFxuICB9IGFzIENvbm5lY3Rpb24sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBERUZBVUxUX1dBSVRJTkdfQ0hST01FX0VYVEVOU0lPTl9JTlNUQUxMX0NIRUNLID0gMTAwMCAqIDM7XG5cbmNvbnN0IFdBTExFVENPTk5FQ1RfU1VQUE9SVF9GRUFUVVJFUyA9IG5ldyBTZXQ8VGVycmFXZWJFeHRlbnNpb25GZWF0dXJlcz4oW1xuICAncG9zdCcsXG5dKTtcblxuY29uc3QgRU1QVFlfU1VQUE9SVF9GRUFUVVJFUyA9IG5ldyBTZXQ8VGVycmFXZWJFeHRlbnNpb25GZWF0dXJlcz4oKTtcblxuLy9ub2luc3BlY3Rpb24gRVM2TWlzc2luZ0F3YWl0XG5leHBvcnQgY2xhc3MgV2FsbGV0Q29udHJvbGxlciB7XG4gIHByaXZhdGUgZXh0ZW5zaW9uOiBFeHRlbnNpb25Sb3V0ZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSB3YWxsZXRDb25uZWN0OiBXYWxsZXRDb25uZWN0Q29udHJvbGxlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5V2FsbGV0OiBSZWFkb25seVdhbGxldENvbnRyb2xsZXIgfCBudWxsID0gbnVsbDtcblxuICBwcml2YXRlIF9hdmFpbGFibGVDb25uZWN0VHlwZXM6IEJlaGF2aW9yU3ViamVjdDxDb25uZWN0VHlwZVtdPjtcbiAgcHJpdmF0ZSBfYXZhaWxhYmxlSW5zdGFsbFR5cGVzOiBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdFR5cGVbXT47XG4gIHByaXZhdGUgX3N0YXRlczogQmVoYXZpb3JTdWJqZWN0PFdhbGxldFN0YXRlcz47XG5cbiAgcHJpdmF0ZSBkaXNhYmxlUmVhZG9ubHlXYWxsZXQ6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGRpc2FibGVFeHRlbnNpb246ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGRpc2FibGVXYWxsZXRDb25uZWN0OiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9ub3RDb25uZWN0ZWQ6IFdhbGxldFN0YXRlcztcbiAgcHJpdmF0ZSByZWFkb25seSBfaW5pdGlhbGl6aW5nOiBXYWxsZXRTdGF0ZXM7XG5cbiAgY29uc3RydWN0b3IocmVhZG9ubHkgb3B0aW9uczogV2FsbGV0Q29udHJvbGxlck9wdGlvbnMpIHtcbiAgICB0aGlzLl9ub3RDb25uZWN0ZWQgPSB7XG4gICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfTk9UX0NPTk5FQ1RFRCxcbiAgICAgIG5ldHdvcms6IG9wdGlvbnMuZGVmYXVsdE5ldHdvcmssXG4gICAgfTtcblxuICAgIHRoaXMuX2luaXRpYWxpemluZyA9IHtcbiAgICAgIHN0YXR1czogV2FsbGV0U3RhdHVzLklOSVRJQUxJWklORyxcbiAgICAgIG5ldHdvcms6IG9wdGlvbnMuZGVmYXVsdE5ldHdvcmssXG4gICAgfTtcblxuICAgIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdFR5cGVbXT4oW1xuICAgICAgQ29ubmVjdFR5cGUuUkVBRE9OTFksXG4gICAgICBDb25uZWN0VHlwZS5XQUxMRVRDT05ORUNULFxuICAgIF0pO1xuXG4gICAgdGhpcy5fYXZhaWxhYmxlSW5zdGFsbFR5cGVzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxDb25uZWN0VHlwZVtdPihbXSk7XG5cbiAgICB0aGlzLl9zdGF0ZXMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFdhbGxldFN0YXRlcz4odGhpcy5faW5pdGlhbGl6aW5nKTtcblxuICAgIGxldCBudW1TZXNzaW9uQ2hlY2s6IG51bWJlciA9IDA7XG5cbiAgICAvLyB3YWl0IGNoZWNraW5nIHRoZSBhdmFpbGFiaWxpdHkgb2YgdGhlIGNocm9tZSBleHRlbnNpb25cbiAgICAvLyAwLiBjaGVjayBpZiBleHRlbnNpb24gd2FsbGV0IHNlc3Npb24gaXMgZXhpc3RzXG4gICAgY2hlY2tFeHRlbnNpb25SZWFkeShcbiAgICAgIG9wdGlvbnMud2FpdGluZ0Nocm9tZUV4dGVuc2lvbkluc3RhbGxDaGVjayA/P1xuICAgICAgICBERUZBVUxUX1dBSVRJTkdfQ0hST01FX0VYVEVOU0lPTl9JTlNUQUxMX0NIRUNLLFxuICAgICAgdGhpcy5pc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyKCksXG4gICAgKS50aGVuKChyZWFkeTogYm9vbGVhbikgPT4ge1xuICAgICAgaWYgKHJlYWR5KSB7XG4gICAgICAgIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcy5uZXh0KFtcbiAgICAgICAgICBDb25uZWN0VHlwZS5FWFRFTlNJT04sXG4gICAgICAgICAgQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVCxcbiAgICAgICAgICBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgICAgXSk7XG5cbiAgICAgICAgdGhpcy5leHRlbnNpb24gPSBuZXcgRXh0ZW5zaW9uUm91dGVyKHtcbiAgICAgICAgICBob3N0V2luZG93OiB3aW5kb3csXG4gICAgICAgICAgc2VsZWN0RXh0ZW5zaW9uOiBvcHRpb25zLnNlbGVjdEV4dGVuc2lvbixcbiAgICAgICAgICBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjazpcbiAgICAgICAgICAgIG9wdGlvbnMuZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2sgPz9cbiAgICAgICAgICAgIERFRkFVTFRfQ0hST01FX0VYVEVOU0lPTl9DT01QQVRJQkxFX0JST1dTRVJfQ0hFQ0ssXG4gICAgICAgICAgZGVmYXVsdE5ldHdvcms6IG9wdGlvbnMuZGVmYXVsdE5ldHdvcmssXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMuZXh0ZW5zaW9uXG4gICAgICAgICAgLnN0YXRlcygpXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBmaWx0ZXIoKHsgdHlwZSB9KSA9PiB0eXBlICE9PSBFeHRlbnNpb25Sb3V0ZXJTdGF0dXMuSU5JVElBTElaSU5HKSxcbiAgICAgICAgICApXG4gICAgICAgICAgLnN1YnNjcmliZSgoZXh0ZW5zaW9uU3RhdGVzKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0gY2F0Y2gge31cblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBleHRlbnNpb25TdGF0ZXMudHlwZSA9PT0gRXh0ZW5zaW9uUm91dGVyU3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgICAgICAgICAgIXRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3QgJiZcbiAgICAgICAgICAgICAgIXRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0XG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy5lbmFibGVFeHRlbnNpb24oKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobnVtU2Vzc2lvbkNoZWNrID09PSAwKSB7XG4gICAgICAgICAgICAgIG51bVNlc3Npb25DaGVjayArPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpc0Rlc2t0b3BDaHJvbWUodGhpcy5pc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyKCkpKSB7XG4gICAgICAgICAgdGhpcy5fYXZhaWxhYmxlSW5zdGFsbFR5cGVzLm5leHQoW0Nvbm5lY3RUeXBlLkVYVEVOU0lPTl0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG51bVNlc3Npb25DaGVjayA9PT0gMCkge1xuICAgICAgICAgIG51bVNlc3Npb25DaGVjayArPSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIDEuIGNoZWNrIGlmIHJlYWRvbmx5IHdhbGxldCBzZXNzaW9uIGlzIGV4aXN0c1xuICAgIGNvbnN0IGRyYWZ0UmVhZG9ubHlXYWxsZXQgPSByZUNvbm5lY3RJZlNlc3Npb25FeGlzdHMoKTtcblxuICAgIGlmIChkcmFmdFJlYWRvbmx5V2FsbGV0KSB7XG4gICAgICB0aGlzLmVuYWJsZVJlYWRvbmx5V2FsbGV0KGRyYWZ0UmVhZG9ubHlXYWxsZXQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIDIuIGNoZWNrIGlmIHdhbGxldGNvbm5lY3Qgc2VzaXNvbiBpcyBleGlzdHNcbiAgICBjb25zdCBkcmFmdFdhbGxldENvbm5lY3QgPSB3Y0Nvbm5lY3RJZlNlc3Npb25FeGlzdHMob3B0aW9ucyk7XG5cbiAgICBpZiAoXG4gICAgICBkcmFmdFdhbGxldENvbm5lY3QgJiZcbiAgICAgIGRyYWZ0V2FsbGV0Q29ubmVjdC5nZXRMYXRlc3RTZXNzaW9uKCkuc3RhdHVzID09PVxuICAgICAgICBXYWxsZXRDb25uZWN0U2Vzc2lvblN0YXR1cy5DT05ORUNURURcbiAgICApIHtcbiAgICAgIHRoaXMuZW5hYmxlV2FsbGV0Q29ubmVjdChkcmFmdFdhbGxldENvbm5lY3QpO1xuICAgIH0gZWxzZSBpZiAobnVtU2Vzc2lvbkNoZWNrID09PSAwKSB7XG4gICAgICBudW1TZXNzaW9uQ2hlY2sgKz0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU29tZSBtb2JpbGUgd2FsbGV0IGVtdWxhdGVzIHRoZSBiZWhhdmlvciBvZiBjaHJvbWUgZXh0ZW5zaW9uLlxuICAgKiBJdCBjb25maXJtcyB0aGF0IHRoZSBjdXJyZW50IGNvbm5lY3Rpb24gZW52aXJvbm1lbnQgaXMgc3VjaCBhIHdhbGxldC5cbiAgICogKElmIHlvdSBhcmUgcnVubmluZyBjb25uZWN0KCkgYnkgY2hlY2tpbmcgYXZhaWxhYmxlQ29ubmVjdFR5cGUsIHlvdSBkbyBub3QgbmVlZCB0byB1c2UgdGhpcyBBUEkuKVxuICAgKlxuICAgKiBAc2VlIFdhbGxldCNpc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyXG4gICAqL1xuICBpc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyID0gKCk6IGJvb2xlYW4gPT4ge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLm9wdGlvbnMuZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2sgPz9cbiAgICAgIERFRkFVTFRfQ0hST01FX0VYVEVOU0lPTl9DT01QQVRJQkxFX0JST1dTRVJfQ0hFQ0tcbiAgICApKG5hdmlnYXRvci51c2VyQWdlbnQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBhdmFpbGFibGUgY29ubmVjdCB0eXBlcyBvbiB0aGUgYnJvd3NlclxuICAgKlxuICAgKiBAc2VlIFdhbGxldCNhdmFpbGFibGVDb25uZWN0VHlwZXNcbiAgICovXG4gIGF2YWlsYWJsZUNvbm5lY3RUeXBlcyA9ICgpOiBPYnNlcnZhYmxlPENvbm5lY3RUeXBlW10+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlQ29ubmVjdFR5cGVzLmFzT2JzZXJ2YWJsZSgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBhdmFpbGFibGUgY29ubmVjdGlvbnMgaW5jbHVkZXMgaWRlbnRpZmllciwgbmFtZSwgaWNvblxuICAgKlxuICAgKiBAc2VlIFdhbGxldCNhdmFpbGFibGVDb25uZWN0aW9uc1xuICAgKi9cbiAgYXZhaWxhYmxlQ29ubmVjdGlvbnMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0aW9uW10+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlQ29ubmVjdFR5cGVzLnBpcGUoXG4gICAgICBtYXAoKGNvbm5lY3RUeXBlcykgPT4ge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uczogQ29ubmVjdGlvbltdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBjb25uZWN0VHlwZSBvZiBjb25uZWN0VHlwZXMpIHtcbiAgICAgICAgICBpZiAoY29ubmVjdFR5cGUgPT09IENvbm5lY3RUeXBlLkVYVEVOU0lPTikge1xuICAgICAgICAgICAgY29uc3QgdGVycmFFeHRlbnNpb25zID0gZ2V0VGVycmFFeHRlbnNpb25zKCk7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgdGVycmFFeHRlbnNpb24gb2YgdGVycmFFeHRlbnNpb25zKSB7XG4gICAgICAgICAgICAgIGNvbm5lY3Rpb25zLnB1c2goXG4gICAgICAgICAgICAgICAgbWVtb0Nvbm5lY3Rpb24oXG4gICAgICAgICAgICAgICAgICBDb25uZWN0VHlwZS5FWFRFTlNJT04sXG4gICAgICAgICAgICAgICAgICB0ZXJyYUV4dGVuc2lvbi5uYW1lLFxuICAgICAgICAgICAgICAgICAgdGVycmFFeHRlbnNpb24uaWNvbixcbiAgICAgICAgICAgICAgICAgIHRlcnJhRXh0ZW5zaW9uLmlkZW50aWZpZXIsXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29ubmVjdGlvbnMucHVzaChDT05ORUNUSU9OU1tjb25uZWN0VHlwZV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzb3J0Q29ubmVjdGlvbnMoY29ubmVjdGlvbnMpO1xuICAgICAgfSksXG4gICAgKTtcbiAgfTtcblxuICAvKipcbiAgICogYXZhaWxhYmxlIGluc3RhbGwgdHlwZXMgb24gdGhlIGJyb3dzZXJcbiAgICpcbiAgICogaW4gdGhpcyB0aW1lLCB0aGlzIG9ubHkgY29udGFpbnMgW0Nvbm5lY3RUeXBlLkVYVEVOU0lPTl1cbiAgICpcbiAgICogQHNlZSBXYWxsZXQjYXZhaWxhYmxlSW5zdGFsbFR5cGVzXG4gICAqL1xuICBhdmFpbGFibGVJbnN0YWxsVHlwZXMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0VHlwZVtdPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKipcbiAgICogYXZhaWxhYmxlIGluc3RhbGxhdGlvbnMgaW5jbHVkZXMgaWRlbnRpZmllciwgbmFtZSwgaWNvbiwgdXJsXG4gICAqXG4gICAqIEBzZWUgV2FsbGV0I2F2YWlsYWJsZUluc3RhbGxhdGlvbnNcbiAgICovXG4gIGF2YWlsYWJsZUluc3RhbGxhdGlvbnMgPSAoKTogT2JzZXJ2YWJsZTxJbnN0YWxsYXRpb25bXT4gPT4ge1xuICAgIHJldHVybiBjb21iaW5lTGF0ZXN0KFt0aGlzLmF2YWlsYWJsZUNvbm5lY3Rpb25zKCksIGdldEV4dGVuc2lvbnMoKV0pLnBpcGUoXG4gICAgICBtYXAoKFtjb25uZWN0aW9ucywgZXh0ZW5zaW9uc10pID0+IHtcbiAgICAgICAgY29uc3QgaW5zdGFsbGVkSWRlbnRpZmllcnMgPSBuZXcgU2V0PHN0cmluZz4oXG4gICAgICAgICAgY29ubmVjdGlvbnNcbiAgICAgICAgICAgIC5maWx0ZXIoKHsgdHlwZSwgaWRlbnRpZmllciB9KSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiB0eXBlID09PSBDb25uZWN0VHlwZS5FWFRFTlNJT04gJiYgISFpZGVudGlmaWVyO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5tYXAoKHsgaWRlbnRpZmllciB9KSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWVyITtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBleHRlbnNpb25zXG4gICAgICAgICAgLmZpbHRlcigoeyBpZGVudGlmaWVyIH0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiAhaW5zdGFsbGVkSWRlbnRpZmllcnMuaGFzKGlkZW50aWZpZXIpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLm1hcCgoeyBuYW1lLCBpZGVudGlmaWVyLCBpY29uLCB1cmwgfSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdHlwZTogQ29ubmVjdFR5cGUuRVhURU5TSU9OLFxuICAgICAgICAgICAgICBpZGVudGlmaWVyLFxuICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICBpY29uLFxuICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgICAgfSksXG4gICAgKTtcbiAgfTtcblxuICAvKipcbiAgICogQHNlZSBXYWxsZXQjc3RhdHVzXG4gICAqIEBzZWUgV2FsbGV0I25ldHdvcmtcbiAgICogQHNlZSBXYWxsZXQjd2FsbGV0c1xuICAgKi9cbiAgc3RhdGVzID0gKCk6IE9ic2VydmFibGU8V2FsbGV0U3RhdGVzPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKiogZ2V0IGNvbm5lY3RlZFdhbGxldCAqL1xuICBjb25uZWN0ZWRXYWxsZXQgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0ZWRXYWxsZXQgfCB1bmRlZmluZWQ+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdGVzLnBpcGUodG9Db25uZWN0ZWRXYWxsZXQodGhpcykpO1xuICB9O1xuXG4gIC8qKiBnZXQgbGNkQ2xpZW50ICovXG4gIGxjZENsaWVudCA9IChcbiAgICBsY2RDbGllbnRDb25maWc/OiBXYWxsZXRMQ0RDbGllbnRDb25maWcsXG4gICk6IE9ic2VydmFibGU8TENEQ2xpZW50PiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlcy5waXBlKHRvTGNkQ2xpZW50KGxjZENsaWVudENvbmZpZykpO1xuICB9O1xuXG4gIC8qKlxuICAgKiByZWxvYWQgdGhlIGNvbm5lY3RlZCB3YWxsZXQgc3RhdGVzXG4gICAqXG4gICAqIGluIHRoaXMgdGltZSwgdGhpcyBvbmx5IHdvcmsgb24gdGhlIENvbm5lY3RUeXBlLkVYVEVOU0lPTlxuICAgKlxuICAgKiBAc2VlIFdhbGxldCNyZWNoZWNrU3RhdHVzXG4gICAqL1xuICByZWZldGNoU3RhdGVzID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmRpc2FibGVFeHRlbnNpb24pIHtcbiAgICAgIHRoaXMuZXh0ZW5zaW9uPy5yZWZldGNoU3RhdGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCBQbGVhc2UgdXNlIGF2YWlsYWJsZUluc3RhbGxhdGlvbnNcbiAgICpcbiAgICogaW5zdGFsbCBmb3IgdGhlIGNvbm5lY3QgdHlwZVxuICAgKlxuICAgKiBAc2VlIFdhbGxldCNpbnN0YWxsXG4gICAqL1xuICBpbnN0YWxsID0gKHR5cGU6IENvbm5lY3RUeXBlKSA9PiB7XG4gICAgaWYgKHR5cGUgPT09IENvbm5lY3RUeXBlLkVYVEVOU0lPTikge1xuICAgICAgLy8gVE9ETyBzZXBhcmF0ZSBpbnN0YWxsIGxpbmtzIGJ5IGJyb3dzZXIgdHlwZXNcbiAgICAgIHdpbmRvdy5vcGVuKENIUk9NRV9FWFRFTlNJT05fSU5TVEFMTF9VUkwsICdfYmxhbmsnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgW1dhbGxldENvbnRyb2xsZXJdIENvbm5lY3RUeXBlIFwiJHt0eXBlfVwiIGRvZXMgbm90IHN1cHBvcnQgaW5zdGFsbCgpIGZ1bmN0aW9uYCxcbiAgICAgICk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBjb25uZWN0IHRvIHdhbGxldFxuICAgKlxuICAgKiBAc2VlIFdhbGxldCNjb25uZWN0XG4gICAqL1xuICBjb25uZWN0ID0gYXN5bmMgKF90eXBlPzogQ29ubmVjdFR5cGUsIF9pZGVudGlmaWVyPzogc3RyaW5nKSA9PiB7XG4gICAgbGV0IHR5cGU6IENvbm5lY3RUeXBlO1xuICAgIGxldCBpZGVudGlmaWVyOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICBpZiAoISFfdHlwZSkge1xuICAgICAgdHlwZSA9IF90eXBlO1xuICAgICAgaWRlbnRpZmllciA9IF9pZGVudGlmaWVyO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjb25uZWN0aW9ucyA9IGF3YWl0IGZpcnN0VmFsdWVGcm9tKHRoaXMuYXZhaWxhYmxlQ29ubmVjdGlvbnMoKSk7XG4gICAgICBjb25zdCBzZWxlY3RvciA9IHRoaXMub3B0aW9ucy5zZWxlY3RDb25uZWN0aW9uID8/IHNlbGVjdENvbm5lY3Rpb247XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IGF3YWl0IHNlbGVjdG9yKGNvbm5lY3Rpb25zKTtcblxuICAgICAgaWYgKCFzZWxlY3RlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHR5cGUgPSBzZWxlY3RlZFswXTtcbiAgICAgIGlkZW50aWZpZXIgPSBzZWxlY3RlZFsxXTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgQ29ubmVjdFR5cGUuUkVBRE9OTFk6XG4gICAgICAgIGNvbnN0IG5ldHdvcmtzOiBOZXR3b3JrSW5mb1tdID0gT2JqZWN0LmtleXMoXG4gICAgICAgICAgdGhpcy5vcHRpb25zLndhbGxldENvbm5lY3RDaGFpbklkcyxcbiAgICAgICAgKS5tYXAoKGNoYWluSWQpID0+IHRoaXMub3B0aW9ucy53YWxsZXRDb25uZWN0Q2hhaW5JZHNbK2NoYWluSWRdKTtcblxuICAgICAgICBjb25zdCBjcmVhdGVSZWFkb25seVdhbGxldFNlc3Npb24gPVxuICAgICAgICAgIHRoaXMub3B0aW9ucy5jcmVhdGVSZWFkb25seVdhbGxldFNlc3Npb24/LihuZXR3b3JrcykgPz9cbiAgICAgICAgICByZWFkb25seVdhbGxldE1vZGFsKHsgbmV0d29ya3MgfSk7XG5cbiAgICAgICAgY29uc3QgcmVhZG9ubHlXYWxsZXRTZXNzaW9uID0gYXdhaXQgY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uO1xuXG4gICAgICAgIGlmIChyZWFkb25seVdhbGxldFNlc3Npb24pIHtcbiAgICAgICAgICB0aGlzLmVuYWJsZVJlYWRvbmx5V2FsbGV0KHJlQ29ubmVjdChyZWFkb25seVdhbGxldFNlc3Npb24pKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVDpcbiAgICAgICAgdGhpcy5lbmFibGVXYWxsZXRDb25uZWN0KHdjQ29ubmVjdCh0aGlzLm9wdGlvbnMpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIENvbm5lY3RUeXBlLkVYVEVOU0lPTjpcbiAgICAgICAgaWYgKCF0aGlzLmV4dGVuc2lvbikge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZXh0ZW5zaW9uIGluc3RhbmNlIGlzIG5vdCBjcmVhdGVkIWApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZXh0ZW5zaW9uLmNvbm5lY3QoaWRlbnRpZmllcik7XG4gICAgICAgIHRoaXMuZW5hYmxlRXh0ZW5zaW9uKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIENvbm5lY3RUeXBlIWApO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogbWFudWFsIGNvbm5lY3QgdG8gcmVhZCBvbmx5IHNlc3Npb25cbiAgICpcbiAgICogQHNlZSBXYWxsZXQjY29ubmVjdFJlYWRvbmx5XG4gICAqL1xuICBjb25uZWN0UmVhZG9ubHkgPSAodGVycmFBZGRyZXNzOiBzdHJpbmcsIG5ldHdvcms6IE5ldHdvcmtJbmZvKSA9PiB7XG4gICAgdGhpcy5lbmFibGVSZWFkb25seVdhbGxldChcbiAgICAgIHJlQ29ubmVjdCh7XG4gICAgICAgIHRlcnJhQWRkcmVzcyxcbiAgICAgICAgbmV0d29yayxcbiAgICAgIH0pLFxuICAgICk7XG4gIH07XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2Rpc2Nvbm5lY3QgKi9cbiAgZGlzY29ubmVjdCA9ICgpID0+IHtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldD8uKCk7XG4gICAgdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXQgPSBudWxsO1xuXG4gICAgdGhpcy5kaXNhYmxlRXh0ZW5zaW9uPy4oKTtcbiAgICB0aGlzLmRpc2FibGVFeHRlbnNpb24gPSBudWxsO1xuXG4gICAgdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdD8uKCk7XG4gICAgdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdCA9IG51bGw7XG5cbiAgICB0aGlzLnVwZGF0ZVN0YXRlcyh0aGlzLl9ub3RDb25uZWN0ZWQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAc2VlIFdhbGxldCNwb3N0XG4gICAqIEBwYXJhbSB0eFxuICAgKiBAcGFyYW0gdGVycmFBZGRyZXNzIG9ubHkgYXZhaWxhYmxlIG5ldyBleHRlbnNpb25cbiAgICovXG4gIHBvc3QgPSBhc3luYyAoXG4gICAgdHg6IENyZWF0ZVR4T3B0aW9ucyxcbiAgICB0ZXJyYUFkZHJlc3M/OiBzdHJpbmcsXG4gICk6IFByb21pc2U8VHhSZXN1bHQ+ID0+IHtcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBleHRlbnNpb25cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBpZiAodGhpcy5kaXNhYmxlRXh0ZW5zaW9uKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2U8VHhSZXN1bHQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmV4dGVuc2lvbikge1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYGV4dGVuc2lvbiBpbnN0YW5jZSBub3QgY3JlYXRlZCFgKSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdGhpcy5leHRlbnNpb24ucG9zdCh0eCwgdGVycmFBZGRyZXNzKS5zdWJzY3JpYmUoe1xuICAgICAgICAgIG5leHQ6ICh0eFJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHR4UmVzdWx0LnN0YXR1cyA9PT0gV2ViRXh0ZW5zaW9uVHhTdGF0dXMuU1VDQ0VFRCkge1xuICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAuLi50eCxcbiAgICAgICAgICAgICAgICByZXN1bHQ6IHR4UmVzdWx0LnBheWxvYWQsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KG1hcEV4dGVuc2lvblR4RXJyb3IodHgsIGVycm9yKSk7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyB3YWxsZXQgY29ubmVjdFxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGVsc2UgaWYgKHRoaXMud2FsbGV0Q29ubmVjdCkge1xuICAgICAgcmV0dXJuIHRoaXMud2FsbGV0Q29ubmVjdFxuICAgICAgICAucG9zdCh0eClcbiAgICAgICAgLnRoZW4oXG4gICAgICAgICAgKHJlc3VsdCkgPT5cbiAgICAgICAgICAgICh7XG4gICAgICAgICAgICAgIC4uLnR4LFxuICAgICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICB9IGFzIFR4UmVzdWx0KSxcbiAgICAgICAgKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgdGhyb3cgbWFwV2FsbGV0Q29ubmVjdEVycm9yKHR4LCBlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIGFyZSBubyBjb25uZWN0aW9ucyB0aGF0IGNhbiBiZSBwb3N0aW5nIHR4IWApO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQHNlZSBXYWxsZXQjc2lnblxuICAgKiBAcGFyYW0gdHhcbiAgICogQHBhcmFtIHRlcnJhQWRkcmVzcyBvbmx5IGF2YWlsYWJsZSBuZXcgZXh0ZW5zaW9uXG4gICAqL1xuICBzaWduID0gYXN5bmMgKFxuICAgIHR4OiBDcmVhdGVUeE9wdGlvbnMsXG4gICAgdGVycmFBZGRyZXNzPzogc3RyaW5nLFxuICApOiBQcm9taXNlPFNpZ25SZXN1bHQ+ID0+IHtcbiAgICBpZiAodGhpcy5kaXNhYmxlRXh0ZW5zaW9uKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2U8U2lnblJlc3VsdD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuZXh0ZW5zaW9uKSB7XG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihgZXh0ZW5zaW9uIGluc3RhbmNlIGlzIG5vdCBjcmVhdGVkIWApKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLmV4dGVuc2lvbi5zaWduKHR4LCB0ZXJyYUFkZHJlc3MpLnN1YnNjcmliZSh7XG4gICAgICAgICAgbmV4dDogKHR4UmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAodHhSZXN1bHQuc3RhdHVzID09PSBXZWJFeHRlbnNpb25UeFN0YXR1cy5TVUNDRUVEKSB7XG4gICAgICAgICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgICAgICAgIC4uLnR4LFxuICAgICAgICAgICAgICAgIHJlc3VsdDogVHguZnJvbURhdGEodHhSZXN1bHQucGF5bG9hZCksXG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KG1hcEV4dGVuc2lvblR4RXJyb3IodHgsIGVycm9yKSk7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgc2lnbigpIG1ldGhvZCBvbmx5IGF2YWlsYWJsZSBvbiBleHRlbnNpb25gKTtcbiAgfTtcblxuICAvKipcbiAgICogQHNlZSBXYWxsZXQjc2lnbkJ5dGVzXG4gICAqIEBwYXJhbSBieXRlc1xuICAgKiBAcGFyYW0gdGVycmFBZGRyZXNzIG9ubHkgYXZhaWxhYmxlIG5ldyBleHRlbnNpb25cbiAgICovXG4gIHNpZ25CeXRlcyA9IGFzeW5jIChcbiAgICBieXRlczogQnVmZmVyLFxuICAgIHRlcnJhQWRkcmVzcz86IHN0cmluZyxcbiAgKTogUHJvbWlzZTxTaWduQnl0ZXNSZXN1bHQ+ID0+IHtcbiAgICBpZiAodGhpcy5kaXNhYmxlRXh0ZW5zaW9uKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2U8U2lnbkJ5dGVzUmVzdWx0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5leHRlbnNpb24pIHtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBleHRlbnNpb24gaW5zdGFuY2UgaXMgbm90IGNyZWF0ZWQhYCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMuZXh0ZW5zaW9uXG4gICAgICAgICAgLnNpZ25CeXRlcyhieXRlcywgdGVycmFBZGRyZXNzKVxuICAgICAgICAgIC5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgbmV4dDogKHR4UmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgIGlmICh0eFJlc3VsdC5zdGF0dXMgPT09IFdlYkV4dGVuc2lvblR4U3RhdHVzLlNVQ0NFRUQpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdDoge1xuICAgICAgICAgICAgICAgICAgICByZWNpZDogdHhSZXN1bHQucGF5bG9hZC5yZWNpZCxcbiAgICAgICAgICAgICAgICAgICAgc2lnbmF0dXJlOiBVaW50OEFycmF5LmZyb20oXG4gICAgICAgICAgICAgICAgICAgICAgQnVmZmVyLmZyb20odHhSZXN1bHQucGF5bG9hZC5zaWduYXR1cmUsICdiYXNlNjQnKSxcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgcHVibGljX2tleTogdHhSZXN1bHQucGF5bG9hZC5wdWJsaWNfa2V5XG4gICAgICAgICAgICAgICAgICAgICAgPyBQdWJsaWNLZXkuZnJvbURhdGEodHhSZXN1bHQucGF5bG9hZC5wdWJsaWNfa2V5KVxuICAgICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgIHJlamVjdChtYXBFeHRlbnNpb25TaWduQnl0ZXNFcnJvcihieXRlcywgZXJyb3IpKTtcbiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBzaWduQnl0ZXMoKSBtZXRob2Qgb25seSBhdmFpbGFibGUgb24gZXh0ZW5zaW9uYCk7XG4gICAgLy8gVE9ETyBpbXBsZW1lbnRzIHNpZ25CeXRlcygpIHRvIG90aGVyIGNvbm5lY3QgdHlwZXNcbiAgfTtcblxuICAvKipcbiAgICogQHNlZSBXYWxsZXQjaGFzQ1cyMFRva2Vuc1xuICAgKiBAcGFyYW0gY2hhaW5JRFxuICAgKiBAcGFyYW0gdG9rZW5BZGRycyBUb2tlbiBhZGRyZXNzZXNcbiAgICovXG4gIGhhc0NXMjBUb2tlbnMgPSBhc3luYyAoXG4gICAgY2hhaW5JRDogc3RyaW5nLFxuICAgIC4uLnRva2VuQWRkcnM6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8eyBbdG9rZW5BZGRyOiBzdHJpbmddOiBib29sZWFuIH0+ID0+IHtcbiAgICBpZiAodGhpcy5hdmFpbGFibGVFeHRlbnNpb25GZWF0dXJlKCdjdzIwLXRva2VuJykpIHtcbiAgICAgIHJldHVybiB0aGlzLmV4dGVuc2lvbiEuaGFzQ1cyMFRva2VucyhjaGFpbklELCAuLi50b2tlbkFkZHJzKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoYERvZXMgbm90IHN1cHBvcnQgaGFzQ1cyMFRva2VucygpIG9uIHRoaXMgY29ubmVjdGlvbmApO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAc2VlIFdhbGxldCNhZGRDVzIwVG9rZW5zXG4gICAqIEBwYXJhbSBjaGFpbklEXG4gICAqIEBwYXJhbSB0b2tlbkFkZHJzIFRva2VuIGFkZHJlc3Nlc1xuICAgKi9cbiAgYWRkQ1cyMFRva2VucyA9IGFzeW5jIChcbiAgICBjaGFpbklEOiBzdHJpbmcsXG4gICAgLi4udG9rZW5BZGRyczogc3RyaW5nW11cbiAgKTogUHJvbWlzZTx7IFt0b2tlbkFkZHI6IHN0cmluZ106IGJvb2xlYW4gfT4gPT4ge1xuICAgIGlmICh0aGlzLmF2YWlsYWJsZUV4dGVuc2lvbkZlYXR1cmUoJ2N3MjAtdG9rZW4nKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uIS5hZGRDVzIwVG9rZW5zKGNoYWluSUQsIC4uLnRva2VuQWRkcnMpO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgRG9lcyBub3Qgc3VwcG9ydCBhZGRDVzIwVG9rZW5zKCkgb24gdGhpcyBjb25uZWN0aW9uYCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBzZWUgV2FsbGV0I2hhc05ldHdvcmtcbiAgICogQHBhcmFtIG5ldHdvcmtcbiAgICovXG4gIGhhc05ldHdvcmsgPSAobmV0d29yazogT21pdDxOZXR3b3JrSW5mbywgJ25hbWUnPik6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIGlmICh0aGlzLmF2YWlsYWJsZUV4dGVuc2lvbkZlYXR1cmUoJ25ldHdvcmsnKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uIS5oYXNOZXR3b3JrKG5ldHdvcmspO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgRG9lcyBub3Qgc3VwcG9ydCBoYXNOZXR3b3JrKCkgb24gdGhpcyBjb25uZWN0aW9uYCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBzZWUgV2FsbGV0I2hhc05ldHdvcmtcbiAgICogQHBhcmFtIG5ldHdvcmtcbiAgICovXG4gIGFkZE5ldHdvcmsgPSAobmV0d29yazogTmV0d29ya0luZm8pOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgICBpZiAodGhpcy5hdmFpbGFibGVFeHRlbnNpb25GZWF0dXJlKCduZXR3b3JrJykpIHtcbiAgICAgIHJldHVybiB0aGlzLmV4dGVuc2lvbiEuYWRkTmV0d29yayhuZXR3b3JrKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoYERvZXMgbm90IHN1cHBvcnQgYWRkTmV0d29yaygpIG9uIHRoaXMgY29ubmVjdGlvbmApO1xuICB9O1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gaW50ZXJuYWxcbiAgLy8gY29ubmVjdCB0eXBlIGNoYW5naW5nXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgcHJpdmF0ZSBhdmFpbGFibGVFeHRlbnNpb25GZWF0dXJlID0gKGZlYXR1cmU6IFRlcnJhV2ViRXh0ZW5zaW9uRmVhdHVyZXMpID0+IHtcbiAgICBpZiAodGhpcy5kaXNhYmxlRXh0ZW5zaW9uICYmIHRoaXMuZXh0ZW5zaW9uKSB7XG4gICAgICBjb25zdCBzdGF0ZXMgPSB0aGlzLmV4dGVuc2lvbi5nZXRMYXN0U3RhdGVzKCk7XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIHN0YXRlcy50eXBlID09PSBFeHRlbnNpb25Sb3V0ZXJTdGF0dXMuV0FMTEVUX0NPTk5FQ1RFRCAmJlxuICAgICAgICBzdGF0ZXMuc3VwcG9ydEZlYXR1cmVzLmhhcyhmZWF0dXJlKVxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgcHJpdmF0ZSB1cGRhdGVTdGF0ZXMgPSAobmV4dDogV2FsbGV0U3RhdGVzKSA9PiB7XG4gICAgY29uc3QgcHJldiA9IHRoaXMuX3N0YXRlcy5nZXRWYWx1ZSgpO1xuXG4gICAgaWYgKFxuICAgICAgbmV4dC5zdGF0dXMgPT09IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVEICYmXG4gICAgICBuZXh0LndhbGxldHMubGVuZ3RoID09PSAwXG4gICAgKSB7XG4gICAgICBuZXh0ID0ge1xuICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfTk9UX0NPTk5FQ1RFRCxcbiAgICAgICAgbmV0d29yazogbmV4dC5uZXR3b3JrLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAocHJldi5zdGF0dXMgIT09IG5leHQuc3RhdHVzIHx8ICFkZWVwRXF1YWwocHJldiwgbmV4dCkpIHtcbiAgICAgIHRoaXMuX3N0YXRlcy5uZXh0KG5leHQpO1xuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIGVuYWJsZVJlYWRvbmx5V2FsbGV0ID0gKHJlYWRvbmx5V2FsbGV0OiBSZWFkb25seVdhbGxldENvbnRyb2xsZXIpID0+IHtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKFxuICAgICAgdGhpcy5yZWFkb25seVdhbGxldCA9PT0gcmVhZG9ubHlXYWxsZXQgfHxcbiAgICAgICh0aGlzLnJlYWRvbmx5V2FsbGV0Py50ZXJyYUFkZHJlc3MgPT09IHJlYWRvbmx5V2FsbGV0LnRlcnJhQWRkcmVzcyAmJlxuICAgICAgICB0aGlzLnJlYWRvbmx5V2FsbGV0Lm5ldHdvcmsgPT09IHJlYWRvbmx5V2FsbGV0Lm5ldHdvcmspXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucmVhZG9ubHlXYWxsZXQpIHtcbiAgICAgIHRoaXMucmVhZG9ubHlXYWxsZXQuZGlzY29ubmVjdCgpO1xuICAgIH1cblxuICAgIHRoaXMucmVhZG9ubHlXYWxsZXQgPSByZWFkb25seVdhbGxldDtcblxuICAgIHRoaXMudXBkYXRlU3RhdGVzKHtcbiAgICAgIHN0YXR1czogV2FsbGV0U3RhdHVzLldBTExFVF9DT05ORUNURUQsXG4gICAgICBuZXR3b3JrOiByZWFkb25seVdhbGxldC5uZXR3b3JrLFxuICAgICAgd2FsbGV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgY29ubmVjdFR5cGU6IENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgICAgICAgIHRlcnJhQWRkcmVzczogcmVhZG9ubHlXYWxsZXQudGVycmFBZGRyZXNzLFxuICAgICAgICAgIGRlc2lnbjogJ3JlYWRvbmx5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBzdXBwb3J0RmVhdHVyZXM6IEVNUFRZX1NVUFBPUlRfRkVBVFVSRVMsXG4gICAgICBjb25uZWN0aW9uOiBDT05ORUNUSU9OUy5SRUFET05MWSxcbiAgICB9KTtcblxuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0ID0gKCkgPT4ge1xuICAgICAgcmVhZG9ubHlXYWxsZXQuZGlzY29ubmVjdCgpO1xuICAgICAgdGhpcy5yZWFkb25seVdhbGxldCA9IG51bGw7XG4gICAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldCA9IG51bGw7XG4gICAgfTtcbiAgfTtcblxuICBwcml2YXRlIGVuYWJsZUV4dGVuc2lvbiA9ICgpID0+IHtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldD8uKCk7XG4gICAgdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdD8uKCk7XG5cbiAgICBpZiAodGhpcy5kaXNhYmxlRXh0ZW5zaW9uIHx8ICF0aGlzLmV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGV4dGVuc2lvblN1YnNjcmlwdGlvbiA9IHRoaXMuZXh0ZW5zaW9uLnN0YXRlcygpLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAoZXh0ZW5zaW9uU3RhdGVzKSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBleHRlbnNpb25TdGF0ZXMudHlwZSA9PT0gRXh0ZW5zaW9uUm91dGVyU3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgICAgICBBY2NBZGRyZXNzLnZhbGlkYXRlKGV4dGVuc2lvblN0YXRlcy53YWxsZXQudGVycmFBZGRyZXNzKVxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgbmV0d29yazogZXh0ZW5zaW9uU3RhdGVzLm5ldHdvcmssXG4gICAgICAgICAgICB3YWxsZXRzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0VHlwZTogQ29ubmVjdFR5cGUuRVhURU5TSU9OLFxuICAgICAgICAgICAgICAgIHRlcnJhQWRkcmVzczogZXh0ZW5zaW9uU3RhdGVzLndhbGxldC50ZXJyYUFkZHJlc3MsXG4gICAgICAgICAgICAgICAgZGVzaWduOiBleHRlbnNpb25TdGF0ZXMud2FsbGV0LmRlc2lnbixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBzdXBwb3J0RmVhdHVyZXM6IGV4dGVuc2lvblN0YXRlcy5zdXBwb3J0RmVhdHVyZXMsXG4gICAgICAgICAgICBjb25uZWN0aW9uOiBtZW1vQ29ubmVjdGlvbihcbiAgICAgICAgICAgICAgQ29ubmVjdFR5cGUuRVhURU5TSU9OLFxuICAgICAgICAgICAgICBleHRlbnNpb25TdGF0ZXMuZXh0ZW5zaW9uSW5mby5uYW1lLFxuICAgICAgICAgICAgICBleHRlbnNpb25TdGF0ZXMuZXh0ZW5zaW9uSW5mby5pY29uLFxuICAgICAgICAgICAgICBleHRlbnNpb25TdGF0ZXMuZXh0ZW5zaW9uSW5mby5pZGVudGlmaWVyLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh0aGlzLl9ub3RDb25uZWN0ZWQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5kaXNhYmxlRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgICAgdGhpcy5leHRlbnNpb24/LmRpc2Nvbm5lY3QoKTtcbiAgICAgIGV4dGVuc2lvblN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5kaXNhYmxlRXh0ZW5zaW9uID0gbnVsbDtcbiAgICB9O1xuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlV2FsbGV0Q29ubmVjdCA9ICh3YWxsZXRDb25uZWN0OiBXYWxsZXRDb25uZWN0Q29udHJvbGxlcikgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMud2FsbGV0Q29ubmVjdCA9PT0gd2FsbGV0Q29ubmVjdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLndhbGxldENvbm5lY3QpIHtcbiAgICAgIHRoaXMud2FsbGV0Q29ubmVjdC5kaXNjb25uZWN0KCk7XG4gICAgfVxuXG4gICAgdGhpcy53YWxsZXRDb25uZWN0ID0gd2FsbGV0Q29ubmVjdDtcblxuICAgIGNvbnN0IHN1YnNjcmliZVdhbGxldENvbm5lY3QgPSAoXG4gICAgICB3YzogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIsXG4gICAgKTogU3Vic2NyaXB0aW9uID0+IHtcbiAgICAgIHJldHVybiB3Yy5zZXNzaW9uKCkuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKHN0YXR1cykgPT4ge1xuICAgICAgICAgIHN3aXRjaCAoc3RhdHVzLnN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBXYWxsZXRDb25uZWN0U2Vzc2lvblN0YXR1cy5DT05ORUNURUQ6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgICAgIG5ldHdvcms6XG4gICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMud2FsbGV0Q29ubmVjdENoYWluSWRzW3N0YXR1cy5jaGFpbklkXSA/P1xuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgICAgICAgICAgICAgIHdhbGxldHM6IFtcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdFR5cGU6IENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhQWRkcmVzczogc3RhdHVzLnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgZGVzaWduOiAnd2FsbGV0Y29ubmVjdCcsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgc3VwcG9ydEZlYXR1cmVzOiBXQUxMRVRDT05ORUNUX1NVUFBPUlRfRkVBVFVSRVMsXG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbjogQ09OTkVDVElPTlMuV0FMTEVUQ09OTkVDVCxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIGNvbnN0IHdhbGxldENvbm5lY3RTZXNzaW9uU3Vic2NyaXB0aW9uID1cbiAgICAgIHN1YnNjcmliZVdhbGxldENvbm5lY3Qod2FsbGV0Q29ubmVjdCk7XG5cbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ID0gKCkgPT4ge1xuICAgICAgdGhpcy53YWxsZXRDb25uZWN0Py5kaXNjb25uZWN0KCk7XG4gICAgICB0aGlzLndhbGxldENvbm5lY3QgPSBudWxsO1xuICAgICAgd2FsbGV0Q29ubmVjdFNlc3Npb25TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3QgPSBudWxsO1xuICAgIH07XG4gIH07XG59XG5cbmNvbnN0IG1lbW9pemVkQ29ubmVjdGlvbnMgPSBuZXcgTWFwPHN0cmluZywgQ29ubmVjdGlvbj4oKTtcblxuZnVuY3Rpb24gbWVtb0Nvbm5lY3Rpb24oXG4gIGNvbm5lY3RUeXBlOiBDb25uZWN0VHlwZSxcbiAgbmFtZTogc3RyaW5nLFxuICBpY29uOiBzdHJpbmcsXG4gIGlkZW50aWZpZXI6IHN0cmluZyB8IHVuZGVmaW5lZCA9ICcnLFxuKTogQ29ubmVjdGlvbiB7XG4gIGNvbnN0IGtleSA9IFtjb25uZWN0VHlwZSwgbmFtZSwgaWNvbiwgaWRlbnRpZmllcl0uam9pbignOycpO1xuXG4gIGlmIChtZW1vaXplZENvbm5lY3Rpb25zLmhhcyhrZXkpKSB7XG4gICAgcmV0dXJuIG1lbW9pemVkQ29ubmVjdGlvbnMuZ2V0KGtleSkhO1xuICB9XG5cbiAgY29uc3QgY29ubmVjdGlvbjogQ29ubmVjdGlvbiA9IHtcbiAgICB0eXBlOiBjb25uZWN0VHlwZSxcbiAgICBuYW1lLFxuICAgIGljb24sXG4gICAgaWRlbnRpZmllcixcbiAgfTtcblxuICBtZW1vaXplZENvbm5lY3Rpb25zLnNldChrZXksIGNvbm5lY3Rpb24pO1xuXG4gIHJldHVybiBjb25uZWN0aW9uO1xufVxuIl19